<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediAssist - Telehealth Services</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
            color: #e74c3c;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: #3498db;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .card h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #34495e;
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .map-container {
            height: 300px;
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        .location-info {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
            color: white;
            font-weight: 600;
        }
        
        .alert-success {
            background-color: #27ae60;
        }
        
        .alert-danger {
            background-color: #e74c3c;
        }
        
        .alert-info {
            background-color: #3498db;
        }
        
        .hidden {
            display: none;
        }
        
        .voice-input {
            display: flex;
            align-items: center;
        }
        
        .voice-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .voice-btn:hover {
            background-color: #2980b9;
        }
        
        .voice-btn i {
            font-size: 1.2rem;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 450px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s;
        }
        
        .chatbot-hidden {
            transform: translateY(calc(100% - 50px));
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .chatbot-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .chatbot-body {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: #f5f7fa;
        }
        
        .chat-message {
            margin-bottom: 1rem;
            max-width: 80%;
            padding: 0.8rem;
            border-radius: 1rem;
        }
        
        .user-message {
            background-color: #3498db;
            color: white;
            margin-left: auto;
            border-top-right-radius: 0;
        }
        
        .bot-message {
            background-color: #e9eef2;
            color: #34495e;
            border-top-left-radius: 0;
        }
        
        .chatbot-footer {
            padding: 1rem;
            border-top: 1px solid #ddd;
            display: flex;
        }
        
        .chatbot-input {
            flex-grow: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .chatbot-send {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 10px;
            cursor: pointer;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Additional Styles for Vitals and Prescription Feature */
        .vitals-container {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .vital-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed #ddd;
        }

        .prescription-list {
            margin-top: 1rem;
        }

        .prescription-item {
            background-color: #f8f9fa;
            padding: 0.8rem;
            border-radius: 5px;
            margin-bottom: 0.8rem;
            border-left: 3px solid #3498db;
        }

        .prescription-item h4 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .prescription-item p {
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        .doctor-note {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px dotted #ddd;
        }

        /* Reminder Section */
        .reminders {
            margin-top: 1rem;
        }

        .reminder-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .reminder-item i {
            margin-right: 0.5rem;
            color: #e74c3c;
        }

        /* Add insurance verification form */
        .insurance-form {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
        }

        /* Follow-up toggle */
        .follow-up-toggle {
            display: flex;
            align-items: center;
            margin-top: 1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #3498db;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
        }

        .typing-indicator span {
            display: inline-block;
        }

        .typing-indicator .dot {
            animation: wave 1.3s linear infinite;
            margin-left: 2px;
        }

        .typing-indicator .dot:nth-child(2) {
            animation-delay: -1.1s;
        }

        .typing-indicator .dot:nth-child(3) {
            animation-delay: -0.9s;
        }

        @keyframes wave {
            0%, 60%, 100% {
                transform: initial;
            }
            30% {
                transform: translateY(-5px);
            }
        }

        /* Database Admin Panel Styles */
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            overflow-y: auto;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-content {
            background-color: white;
            max-width: 1000px;
            margin: 50px auto;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            padding: 2rem;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 1rem;
        }
        
        .admin-close {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
        }
        
        .admin-tab {
            padding: 0.8rem 1.5rem;
            margin-right: 0.5rem;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }
        
        .admin-tab.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 0.8rem;
            text-align: left;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .clear-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            cursor: pointer;
        }

        /* Language selector styles */
        .language-selector {
            position: relative;
            margin-left: 1.5rem;
        }

        .language-select {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 5px;
            padding: 0.3rem 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="white" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 30px;
        }

        .language-select:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .language-select option {
            background-color: #2c3e50;
            color: white;
        }
        
        .refresh-lang-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 5px;
            width: 28px;
            height: 28px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin-left: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .refresh-lang-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-heartbeat"></i>
            HealthConnect
        </div>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="#">Doctors</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
                <li class="language-selector">
                    <select id="language-select" class="language-select">
                        <option value="en">English</option>
                        <option value="hi">हिंदी (Hindi)</option>
                        <option value="bn">বাংলা (Bengali)</option>
                        <option value="te">తెలుగు (Telugu)</option>
                        <option value="ta">தமிழ் (Tamil)</option>
                        <option value="mr">मराठी (Marathi)</option>
                        <option value="gu">ગુજરાતી (Gujarati)</option>
                        <option value="kn">ಕನ್ನಡ (Kannada)</option>
                        <option value="ml">മലയാളം (Malayalam)</option>
                    </select>
                    <button id="refresh-lang" class="refresh-lang-btn" title="Refresh Translation"><i class="fas fa-sync-alt"></i></button>
                </li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div id="alerts-container"></div>
        
        <div class="main-content">
            <div class="left-column">
                <div class="card">
                    <h2><i class="fas fa-user-md"></i> Telehealth Consultation</h2>
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" class="form-control" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" class="form-control" placeholder="Enter your phone number">
                    </div>
                    <div class="form-group">
                        <label for="problem">Describe Your Health Issue</label>
                        <div class="voice-input">
                            <textarea id="problem" class="form-control" rows="4" placeholder="Please describe your symptoms or health concerns"></textarea>
                            <button class="voice-btn" id="voice-btn" title="Use Voice Input">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary btn-block" id="submit-btn">Submit Consultation Request</button>
                    </div>

                    <!-- Insurance Verification Section -->
                    <div class="insurance-form">
                        <h3><i class="fas fa-id-card"></i> Insurance Verification</h3>
                        <div class="form-group">
                            <label for="insurance-provider">Insurance Provider</label>
                            <input type="text" id="insurance-provider" class="form-control" placeholder="Enter your insurance provider">
                        </div>
                        <div class="form-group">
                            <label for="insurance-id">Member ID</label>
                            <input type="text" id="insurance-id" class="form-control" placeholder="Enter your member ID">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary" id="verify-insurance-btn">Verify Coverage</button>
                        </div>
                    </div>

                    <!-- Follow-up Toggle -->
                    <div class="follow-up-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="follow-up-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Schedule automatic follow-up reminder</span>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-video"></i> Relevant Health Videos</h2>
                    <p>Enter your health issue above to see relevant videos.</p>
                    <div class="video-container" id="video-container">
                        <!-- Videos will be populated here -->
                        <div class="loading hidden" id="video-loading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Prescription and Medical History Card -->
                <div class="card">
                    <h2><i class="fas fa-prescription-bottle-alt"></i> Your Prescriptions</h2>
                    <p>Here are your current prescriptions:</p>
                    <div class="prescription-list" id="prescription-list">
                        <!-- Example prescription items -->
                        <div class="prescription-item">
                            <h4>Amoxicillin 500mg</h4>
                            <p><strong>Dosage:</strong> 1 tablet, 3 times daily</p>
                            <p><strong>Duration:</strong> 7 days</p>
                            <p><strong>Prescribed by:</strong> Dr. Sarah Johnson</p>
                            <p class="doctor-note">Take with food. Complete the full course.</p>
                        </div>
                    </div>
                    <div class="reminders">
                        <h3>Medication Reminders</h3>
                        <div class="reminder-item">
                            <i class="fas fa-bell"></i>
                            <span>Amoxicillin - Take next dose at 2:00 PM</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-column">
                <div class="card">
                    <h2><i class="fas fa-map-marker-alt"></i> Your Location</h2>
                    <p>We need your location to provide better services and for emergency situations.</p>
                    <div class="map-container">
                        <div id="map"></div>
                    </div>
                    <div class="location-info" id="location-info">
                        Fetching your location...
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <button class="btn btn-danger btn-block" id="sos-btn">
                            <i class="fas fa-exclamation-triangle"></i> Send SOS Alert
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-calendar-alt"></i> Quick Schedule</h2>
                    <div class="form-group">
                        <label for="appointment-date">Preferred Date</label>
                        <input type="date" id="appointment-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="appointment-time">Preferred Time</label>
                        <input type="time" id="appointment-time" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="doctor-specialty">Doctor Specialty</label>
                        <select id="doctor-specialty" class="form-control">
                            <option value="">Select Specialty</option>
                            <option value="general">General Practitioner</option>
                            <option value="cardiology">Cardiologist</option>
                            <option value="dermatology">Dermatologist</option>
                            <option value="neurology">Neurologist</option>
                            <option value="pediatrics">Pediatrician</option>
                            <option value="psychiatry">Psychiatrist</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary btn-block" id="schedule-btn">Schedule Appointment</button>
                    </div>
                </div>

                <!-- Vitals Monitoring Card -->
                <div class="card">
                    <h2><i class="fas fa-heartbeat"></i> Your Vitals</h2>
                    <p>Recent vital measurements:</p>
                    <div class="vitals-container">
                        <div class="vital-item">
                            <span>Blood Pressure:</span>
                            <span>120/80 mmHg</span>
                        </div>
                        <div class="vital-item">
                            <span>Heart Rate:</span>
                            <span>72 BPM</span>
                        </div>
                        <div class="vital-item">
                            <span>Oxygen Saturation:</span>
                            <span>98%</span>
                        </div>
                        <div class="vital-item">
                            <span>Temperature:</span>
                            <span>98.6°F</span>
                        </div>
                        <div class="vital-item">
                            <span>Last Updated:</span>
                            <span>Today, 9:30 AM</span>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <button class="btn btn-primary btn-block" id="update-vitals-btn">
                            <i class="fas fa-sync-alt"></i> Update Vitals
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Chatbot Widget -->
    <div class="chatbot-container chatbot-hidden" id="chatbot-container">
        <div class="chatbot-header" id="chatbot-header">
            <h3><i class="fas fa-robot"></i> HealthBot</h3>
            <span id="chatbot-toggle"><i class="fas fa-chevron-up"></i></span>
        </div>
        <div class="chatbot-body" id="chatbot-body">
            <div class="chat-message bot-message">
                Hello! I'm HealthBot, your virtual health assistant. How can I help you today?
            </div>
        </div>
        <div class="chatbot-footer">
            <input type="text" class="chatbot-input" id="chatbot-input" placeholder="Type your message...">
            <button class="chatbot-send" id="chatbot-send">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Database Admin Panel -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-content">
            <div class="admin-header">
                <h2><i class="fas fa-database"></i> Database Administration</h2>
                <button class="admin-close" id="admin-close">Close</button>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="user-details">User Details</div>
                <div class="admin-tab" data-tab="consultations">Consultations</div>
                <div class="admin-tab" data-tab="appointments">Appointments</div>
                <div class="admin-tab" data-tab="insurance">Insurance</div>
            </div>
            
            <div class="admin-tab-content active" id="user-details-tab">
                <div class="data-controls">
                    <h3>Registered Users</h3>
                    <div>
                        <button class="refresh-btn" id="refresh-users"><i class="fas fa-sync-alt"></i> Refresh</button>
                        <button class="clear-btn" id="clear-users"><i class="fas fa-trash-alt"></i> Clear Data</button>
                    </div>
                </div>
                <div id="user-details-data">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Created At</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5">Loading data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="admin-tab-content" id="consultations-tab">
                <div class="data-controls">
                    <h3>Consultation Requests</h3>
                    <div>
                        <button class="refresh-btn" id="refresh-consultations"><i class="fas fa-sync-alt"></i> Refresh</button>
                        <button class="clear-btn" id="clear-consultations"><i class="fas fa-trash-alt"></i> Clear Data</button>
                    </div>
                </div>
                <div id="consultations-data">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Problem</th>
                                <th>Location</th>
                                <th>Created At</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="7">Loading data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="admin-tab-content" id="appointments-tab">
                <div class="data-controls">
                    <h3>Scheduled Appointments</h3>
                    <div>
                        <button class="refresh-btn" id="refresh-appointments"><i class="fas fa-sync-alt"></i> Refresh</button>
                        <button class="clear-btn" id="clear-appointments"><i class="fas fa-trash-alt"></i> Clear Data</button>
                    </div>
                </div>
                <div id="appointments-data">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Specialty</th>
                                <th>Created At</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5">Loading data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="admin-tab-content" id="insurance-tab">
                <div class="data-controls">
                    <h3>Insurance Verifications</h3>
                    <div>
                        <button class="refresh-btn" id="refresh-insurance"><i class="fas fa-sync-alt"></i> Refresh</button>
                        <button class="clear-btn" id="clear-insurance"><i class="fas fa-trash-alt"></i> Clear Data</button>
                    </div>
                </div>
                <div id="insurance-data">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Provider</th>
                                <th>Member ID</th>
                                <th>Verified</th>
                                <th>Created At</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5">Loading data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let map;
        let userLocation = null;
        let isListening = false;
        let recognition;
        const API_BASE_URL = 'http://localhost:3000';
        let db = null;
        let isDbAvailable = false;
        // Add local storage fallback
        let localData = {
            users: [],
            consultations: [],
            appointments: [],
            insurance: []
        };
        let currentLanguage = 'en';
        
        // Translations for multiple languages
        const translations = {
            // English (default)
            en: {
                // Header & Navigation
                home: "Home",
                services: "Services",
                doctors: "Doctors",
                about: "About",
                contact: "Contact",
                
                // Consultation Form
                telehealthConsultation: "Telehealth Consultation",
                fullName: "Full Name",
                enterFullName: "Enter your full name",
                emailAddress: "Email Address",
                enterEmail: "Enter your email",
                phoneNumber: "Phone Number",
                enterPhone: "Enter your phone number",
                healthIssue: "Describe Your Health Issue",
                healthConcerns: "Please describe your symptoms or health concerns",
                submitRequest: "Submit Consultation Request",
                
                // Insurance Form
                insuranceVerification: "Insurance Verification",
                insuranceProvider: "Insurance Provider",
                enterInsurance: "Enter your insurance provider",
                memberId: "Member ID",
                enterMemberId: "Enter your member ID",
                verifyCoverage: "Verify Coverage",
                followUpReminder: "Schedule automatic follow-up reminder",
                
                // Quick Schedule
                quickSchedule: "Quick Schedule",
                preferredDate: "Preferred Date",
                preferredTime: "Preferred Time",
                doctorSpecialty: "Doctor Specialty",
                selectSpecialty: "Select Specialty",
                generalPractitioner: "General Practitioner",
                cardiologist: "Cardiologist",
                dermatologist: "Dermatologist",
                neurologist: "Neurologist",
                pediatrician: "Pediatrician",
                psychiatrist: "Psychiatrist",
                scheduleAppointment: "Schedule Appointment",
                
                // Location
                yourLocation: "Your Location",
                locationDesc: "We need your location to provide better services and for emergency situations.",
                fetchingLocation: "Fetching your location...",
                sendSOS: "Send SOS Alert",
                
                // Vitals
                yourVitals: "Your Vitals",
                recentVitals: "Recent vital measurements:",
                bloodPressure: "Blood Pressure:",
                heartRate: "Heart Rate:",
                oxygenSaturation: "Oxygen Saturation:",
                temperature: "Temperature:",
                lastUpdated: "Last Updated:",
                updateVitals: "Update Vitals",
                
                // Chatbot
                healthbot: "HealthBot",
                typingMessage: "Typing",
                chatbotGreeting: "Hello! I'm HealthBot, your virtual health assistant. How can I help you today?",
                typeMessage: "Type your message...",
                
                // Admin Panel
                adminTitle: "Database Administration",
                closeButton: "Close",
                userDetailsTab: "User Details",
                consultationsTab: "Consultations",
                appointmentsTab: "Appointments",
                insuranceTab: "Insurance",
                registeredUsers: "Registered Users",
                consultationRequests: "Consultation Requests",
                scheduledAppointments: "Scheduled Appointments",
                insuranceVerifications: "Insurance Verifications",
                refreshButton: "Refresh",
                clearDataButton: "Clear Data",
                
                // Alerts
                databaseNotSupported: "Your browser does not support local database storage. Using fallback storage.",
                databaseError: "Error initializing database. Using fallback storage.",
                fillAllFields: "Please fill in all required fields.",
                invalidEmail: "Please enter a valid email address.",
                requestSubmitted: "Your consultation request has been submitted successfully with ID: {id}! A healthcare professional will contact you shortly.",
                errorSubmitting: "Error saving your consultation request: {error}",
                sosConfirm: "This will send an emergency alert to medical services with your current location. Continue?",
                sosSent: "Emergency alert sent! Medical assistance has been notified of your location. Stay on this page for updates.",
                emergencyAlert: "EMERGENCY ALERT: Medical services have been notified. Please stay where you are if possible. Estimated arrival time: 8-12 minutes.",
                selectDateTime: "Please select date, time, and doctor specialty.",
                selectFutureDate: "Please select a future date and time.",
                appointmentScheduled: "Your appointment has been scheduled successfully with ID: {id}! You will receive a confirmation email shortly.",
                appointmentError: "Error scheduling your appointment. Please try again later.",
                verifyError: "Please enter both insurance provider and member ID.",
                coverageVerified: "Insurance coverage verified (ID: {id})! Your plan covers telehealth consultations with a $20 copay.",
                coverageNotVerified: "Could not verify insurance coverage (ID: {id}). Please double-check your information or contact your provider.",
                followUpEnabled: "Automatic follow-up reminders enabled. You will receive a notification 7 days after your consultation.",
                
                // Table Headers
                thId: "ID",
                thName: "Name",
                thEmail: "Email",
                thPhone: "Phone",
                thCreatedAt: "Created At",
                thProblem: "Problem",
                thLocation: "Location",
                thDate: "Date",
                thTime: "Time",
                thSpecialty: "Specialty",
                thProvider: "Provider",
                thMemberId: "Member ID",
                thVerified: "Verified"
            },
            
            // Hindi
            hi: {
                // Header & Navigation
                home: "होम",
                services: "सेवाएं",
                doctors: "डॉक्टर",
                about: "हमारे बारे में",
                contact: "संपर्क",
                
                // Consultation Form
                telehealthConsultation: "टेलीहेल्थ परामर्श",
                fullName: "पूरा नाम",
                enterFullName: "अपना पूरा नाम दर्ज करें",
                emailAddress: "ईमेल पता",
                enterEmail: "अपना ईमेल दर्ज करें",
                phoneNumber: "फ़ोन नंबर",
                enterPhone: "अपना फोन नंबर दर्ज करें",
                healthIssue: "अपनी स्वास्थ्य समस्या का वर्णन करें",
                healthConcerns: "कृपया अपने लक्षणों या स्वास्थ्य संबंधी चिंताओं का वर्णन करें",
                submitRequest: "परामर्श अनुरोध सबमिट करें",
                
                // Insurance Form
                insuranceVerification: "बीमा सत्यापन",
                insuranceProvider: "बीमा प्रदाता",
                enterInsurance: "अपने बीमा प्रदाता दर्ज करें",
                memberId: "सदस्य आईडी",
                enterMemberId: "अपनी सदस्य आईडी दर्ज करें",
                verifyCoverage: "कवरेज सत्यापित करें",
                followUpReminder: "स्वचालित फॉलो-अप रिमाइंडर शेड्यूल करें",
                
                // Quick Schedule
                quickSchedule: "त्वरित अपॉइंटमेंट",
                preferredDate: "पसंदीदा तारीख",
                preferredTime: "पसंदीदा समय",
                doctorSpecialty: "डॉक्टर विशेषज्ञता",
                selectSpecialty: "विशेषज्ञता चुनें",
                generalPractitioner: "सामान्य चिकित्सक",
                cardiologist: "हृदय रोग विशेषज्ञ",
                dermatologist: "त्वचा विशेषज्ञ",
                neurologist: "न्यूरोलॉजिस्ट",
                pediatrician: "बाल रोग विशेषज्ञ",
                psychiatrist: "मनोचिकित्सक",
                scheduleAppointment: "अपॉइंटमेंट शेड्यूल करें",
                
                // Location
                yourLocation: "आपका स्थान",
                locationDesc: "बेहतर सेवाएं प्रदान करने और आपातकालीन स्थितियों के लिए हमें आपके स्थान की जानकारी चाहिए।",
                fetchingLocation: "आपका स्थान प्राप्त कर रहे हैं...",
                sendSOS: "SOS अलर्ट भेजें",
                
                // Vitals
                yourVitals: "आपके वाइटल्स",
                recentVitals: "हाल के वाइटल माप:",
                bloodPressure: "रक्तचाप:",
                heartRate: "हृदय गति:",
                oxygenSaturation: "ऑक्सीजन संतृप्ति:",
                temperature: "तापमान:",
                lastUpdated: "अंतिम अपडेट:",
                updateVitals: "वाइटल्स अपडेट करें",
                
                // Chatbot
                healthbot: "हेल्थबॉट",
                typingMessage: "टाइपिंग",
                chatbotGreeting: "नमस्ते! मैं हेल्थबॉट हूं, आपका वर्चुअल स्वास्थ्य सहायक। मैं आपकी कैसे मदद कर सकता हूं?",
                typeMessage: "अपना संदेश टाइप करें...",
                
                // Admin Panel
                adminTitle: "डेटाबेस प्रशासन",
                closeButton: "बंद करें",
                userDetailsTab: "उपयोगकर्ता विवरण",
                consultationsTab: "परामर्श",
                appointmentsTab: "अपॉइंटमेंट",
                insuranceTab: "बीमा",
                registeredUsers: "पंजीकृत उपयोगकर्ता",
                consultationRequests: "परामर्श अनुरोध",
                scheduledAppointments: "शेड्यूल किए गए अपॉइंटमेंट",
                insuranceVerifications: "बीमा सत्यापन",
                refreshButton: "रिफ्रेश",
                clearDataButton: "डेटा साफ़ करें",
                
                // Alerts
                databaseNotSupported: "आपका ब्राउज़र लोकल डेटाबेस स्टोरेज का समर्थन नहीं करता है। फॉलबैक स्टोरेज का उपयोग कर रहे हैं।",
                databaseError: "डेटाबेस को इनिशियलाइज़ करने में त्रुटि। फॉलबैक स्टोरेज का उपयोग कर रहे हैं।",
                fillAllFields: "कृपया सभी आवश्यक फ़ील्ड भरें।",
                invalidEmail: "कृपया एक वैध ईमेल पता दर्ज करें।",
                requestSubmitted: "आपका परामर्श अनुरोध ID: {id} के साथ सफलतापूर्वक सबमिट किया गया है! एक स्वास्थ्य पेशेवर जल्द ही आपसे संपर्क करेगा।",
                errorSubmitting: "आपके परामर्श अनुरोध को सहेजने में त्रुटि: {error}",
                sosConfirm: "यह आपके वर्तमान स्थान के साथ चिकित्सा सेवाओं को आपातकालीन अलर्ट भेजेगा। जारी रखें?",
                sosSent: "आपातकालीन अलर्ट भेजा गया! चिकित्सा सहायता को आपके स्थान की सूचना दी गई है। अपडेट के लिए इस पेज पर बने रहें।",
                emergencyAlert: "आपातकालीन अलर्ट: चिकित्सा सेवाओं को सूचित किया गया है। कृपया यदि संभव हो तो जहां हैं वहीं रहें। अनुमानित आगमन समय: 8-12 मिनट।",
                selectDateTime: "कृपया तिथि, समय और डॉक्टर विशेषज्ञता का चयन करें।",
                selectFutureDate: "कृपया भविष्य की तिथि और समय का चयन करें।",
                appointmentScheduled: "आपका अपॉइंटमेंट ID: {id} के साथ सफलतापूर्वक शेड्यूल किया गया है! आपको जल्द ही एक पुष्टिकरण ईमेल मिलेगा।",
                appointmentError: "आपके अपॉइंटमेंट को शेड्यूल करने में त्रुटि। कृपया बाद में पुनः प्रयास करें।",
                verifyError: "कृपया बीमा प्रदाता और सदस्य आईडी दोनों दर्ज करें।",
                coverageVerified: "बीमा कवरेज ID: {id} के साथ सत्यापित किया गया! आपकी योजना $20 कोपे के साथ टेलीहेल्थ परामर्श को कवर करती है।",
                coverageNotVerified: "बीमा कवरेज ID: {id} को सत्यापित नहीं किया जा सका। कृपया अपनी जानकारी दोबारा जांचें या अपने प्रदाता से संपर्क करें।",
                followUpEnabled: "स्वचालित फॉलो-अप रिमाइंडर सक्षम किए गए। आपको अपने परामर्श के 7 दिन बाद एक सूचना मिलेगी।",
                
                // Table Headers
                thId: "आईडी",
                thName: "नाम",
                thEmail: "ईमेल",
                thPhone: "फोन",
                thCreatedAt: "बनाया गया",
                thProblem: "समस्या",
                thLocation: "स्थान",
                thDate: "तारीख",
                thTime: "समय",
                thSpecialty: "विशेषज्ञता",
                thProvider: "प्रदाता",
                thMemberId: "सदस्य आईडी",
                thVerified: "सत्यापित"
            },
            
            // Bengali
            bn: {
                // Header & Navigation
                home: "হোম",
                services: "সেবা",
                doctors: "ডাক্তার",
                about: "আমাদের সম্পর্কে",
                contact: "যোগাযোগ",
                
                // Consultation Form
                telehealthConsultation: "টেলিহেলথ পরামর্শ",
                fullName: "পুরো নাম",
                enterFullName: "আপনার পুরো নাম লিখুন",
                emailAddress: "ইমেইল ঠিকানা",
                enterEmail: "আপনার ইমেইল লিখুন",
                phoneNumber: "ফোন নম্বর",
                enterPhone: "আপনার ফোন নম্বর লিখুন",
                healthIssue: "আপনার স্বাস্থ্য সমস্যা বর্ণনা করুন",
                healthConcerns: "আপনার উপসর্গ বা স্বাস্থ্য সংক্রান্ত উদ্বেগ বর্ণনা করুন",
                submitRequest: "পরামর্শ অনুরোধ জমা দিন",
                
                // Insurance Form
                insuranceVerification: "বীমা যাচাইকরণ",
                insuranceProvider: "বীমা প্রদানকারী",
                enterInsurance: "আপনার বীমা প্রদানকারী লিখুন",
                memberId: "সদস্য আইডি",
                enterMemberId: "আপনার সদস্য আইডি লিখুন",
                verifyCoverage: "কভারেজ যাচাই করুন",
                followUpReminder: "স্বয়ংক্রিয় ফলো-আপ রিমাইন্ডার সেট করুন",
                
                // Quick Schedule
                quickSchedule: "দ্রুত সাক্ষাৎকার",
                preferredDate: "পছন্দের তারিখ",
                preferredTime: "পছন্দের সময়",
                doctorSpecialty: "ডাক্তারের বিশেষজ্ঞতা",
                selectSpecialty: "বিশেষজ্ঞতা নির্বাচন করুন",
                generalPractitioner: "সাধারণ চিকিৎসক",
                cardiologist: "হৃদরোগ বিশেষজ্ঞ",
                dermatologist: "চর্মরোগ বিশেষজ্ঞ",
                neurologist: "স্নায়ুরোগ বিশেষজ্ঞ",
                pediatrician: "শিশুরোগ বিশেষজ্ঞ",
                psychiatrist: "মনোরোগ বিশেষজ্ঞ",
                scheduleAppointment: "সাক্ষাৎকার সেট করুন",
                
                // Location
                yourLocation: "আপনার অবস্থান",
                locationDesc: "আমরা আপনাকে ভালো সেবা প্রদান করার জন্য এবং জরুরি পরিস্থিতিতে আপনার অবস্থান জানতে চাই।",
                fetchingLocation: "আপনার অবস্থান আনছি...",
                sendSOS: "এসওএস অ্যালার্ট পাঠান",
                
                // Vitals
                yourVitals: "আপনার ভাইটালস",
                recentVitals: "সাম্প্রতিক ভাইটাল পরিমাপ:",
                bloodPressure: "রক্তচাপ:",
                heartRate: "হার্ট রেট:",
                oxygenSaturation: "অক্সিজেন স্যাচুরেশন:",
                temperature: "তাপমাত্রা:",
                lastUpdated: "সর্বশেষ আপডেট:",
                updateVitals: "ভাইটালস আপডেট করুন",
                
                // Chatbot
                healthbot: "হেলথবট",
                typingMessage: "টাইপিং",
                chatbotGreeting: "হ্যালো! আমি হেলথবট, আপনার ভার্চুয়াল স্বাস্থ্য সহায়ক। আমি আপনাকে কীভাবে সাহায্য করতে পারি?",
                typeMessage: "আপনার বার্তা টাইপ করুন...",
                
                // Admin Panel
                adminTitle: "ডাটাবেস অ্যাডমিনিস্ট্রেশন",
                closeButton: "বন্ধ করুন",
                userDetailsTab: "ব্যবহারকারীর বিবরণ",
                consultationsTab: "পরামর্শ",
                appointmentsTab: "সাক্ষাৎকার",
                insuranceTab: "বীমা",
                registeredUsers: "নিবন্ধিত ব্যবহারকারী",
                consultationRequests: "পরামর্শ অনুরোধ",
                scheduledAppointments: "সেট করা সাক্ষাৎকার",
                insuranceVerifications: "বীমা যাচাইকরণ",
                refreshButton: "রিফ্রেশ",
                clearDataButton: "ডাটা মুছুন",
                
                // Table Headers
                thId: "আইডি",
                thName: "নাম",
                thEmail: "ইমেইল",
                thPhone: "ফোন",
                thCreatedAt: "তৈরি করা হয়েছে",
                thProblem: "সমস্যা",
                thLocation: "অবস্থান",
                thDate: "তারিখ",
                thTime: "সময়",
                thSpecialty: "বিশেষজ্ঞতা",
                thProvider: "প্রদানকারী",
                thMemberId: "সদস্য আইডি",
                thVerified: "যাচাইকৃত"
            },
            
            // Add more languages as needed (Telugu, Tamil, etc.)
        };
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved language preference
            try {
                const savedLanguage = localStorage.getItem('preferred_language');
                if (savedLanguage) {
                    document.getElementById('language-select').value = savedLanguage;
                    currentLanguage = savedLanguage;
                }
            } catch (e) {
                console.error('Error loading language preference:', e);
            }
            
            // Initialize SQLite database
            initDatabase();
            
            // Initialize speech recognition
            initSpeechRecognition();
            
            // Initialize event listeners
            initEventListeners();
            
            // Initialize chatbot
            initChatbot();
            
            // Start location fetching
            fetchUserLocation();

            // Load mock prescription data
            loadPrescriptions();

            // Initialize update vitals functionality
            initUpdateVitals();

            // Initialize insurance verification
            initInsuranceVerification();
            
            // Apply translations
            console.log('Initial application of translations on page load');
            updateUILanguage();
            
            // Double-check translations after a small delay to ensure DOM is fully ready
            setTimeout(() => {
                console.log('Double-checking translations after delay');
                updateUILanguage();
            }, 500);
            
            // Set up form submission handlers
            setupFormHandlers();
        });
        
        // Set up form submission handlers
        function setupFormHandlers() {
            console.log('Setting up form submission handlers');
            
            // Consultation form
            const consultationForm = document.getElementById('consultation-form');
            if (consultationForm) {
                console.log('Adding submit handler to consultation form');
                consultationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Consultation form submitted');
                    submitConsultationRequest();
                });
            } else {
                console.log('Consultation form not found');
            }
            
            // Appointment form
            const appointmentForm = document.getElementById('appointment-form');
            if (appointmentForm) {
                console.log('Adding submit handler to appointment form');
                appointmentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Appointment form submitted');
                    scheduleAppointment();
                });
            } else {
                console.log('Appointment form not found');
            }
            
            // Insurance verification form
            const insuranceForm = document.getElementById('insurance-form');
            if (insuranceForm) {
                console.log('Adding submit handler to insurance form');
                insuranceForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Insurance form submitted');
                    verifyInsurance();
                });
            } else {
                console.log('Insurance form not found');
            }
        }
        
        // Initialize SQLite database
        function initDatabase() {
            try {
                // We'll rely on backend SQLite3 database instead of client-side WebSQL
                isDbAvailable = false;
                console.log('Using backend SQLite3 database for storage');
                
                // Initialize local storage as fallback
                localData = {
                    consultations: [],
                    users: [],
                    appointments: [],
                    insurance: []
                };
                
                // Load data from localStorage if exists (as fallback)
                try {
                    const savedData = localStorage.getItem('healthconnect_data');
                    if (savedData) {
                        localData = JSON.parse(savedData);
                        console.log('Loaded fallback data from local storage');
                    }
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                }
                
                // Check backend connectivity
                fetch('/api/telehealth/consultations')
                    .then(response => {
                        if (response.ok) {
                            console.log('Backend database connectivity confirmed');
                            showAlert('Connected to healthcare database', 'success', 2000);
                        } else {
                            console.warn('Backend database returned error:', response.status);
                            showAlert('Using local storage as database is unavailable', 'warning');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Received data from backend:', data);
                    })
                    .catch(error => {
                        console.error('Error connecting to backend database:', error);
                        showAlert('Error connecting to database. Using local storage fallback.', 'warning');
                    });
            } catch (e) {
                console.error('Unexpected error during database initialization:', e);
                showAlert('Unexpected error during database initialization. Using fallback storage.', 'danger');
            }
        }
        
        // Save consultation to database
        function saveConsultationToDatabase(consultationData) {
            console.log('Saving consultation data:', consultationData);
            
            if (!isDbAvailable || !db) {
                console.log('Database not available, using localStorage fallback');
                
                // Generate a simple ID
                const id = Date.now();
                
                // Add timestamp
                const data = {
                    ...consultationData,
                    id: id,
                    created_at: new Date().toISOString()
                };
                
                // Add to local storage
                localData.consultations.push(data);
                
                // Save to localStorage
                try {
                    localStorage.setItem('healthconnect_data', JSON.stringify(localData));
                    console.log('Saved consultation to localStorage with ID:', id);
                    return Promise.resolve(id);
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                    return Promise.reject(new Error('Error saving to localStorage: ' + e.message));
                }
            }
            
            return new Promise((resolve, reject) => {
                try {
                    db.transaction(function(tx) {
                        tx.executeSql(
                            'INSERT INTO consultations (name, email, phone, problem, lat, lng) VALUES (?, ?, ?, ?, ?, ?)',
                            [
                                consultationData.name,
                                consultationData.email,
                                consultationData.phone,
                                consultationData.problem,
                                consultationData.location ? consultationData.location.lat : null,
                                consultationData.location ? consultationData.location.lng : null
                            ],
                            function(tx, results) {
                                console.log('Consultation saved with ID:', results.insertId);
                                resolve(results.insertId);
                            },
                            function(tx, error) {
                                console.error('Error saving consultation:', error.message);
                                reject(error);
                            }
                        );
                    },
                    function(error) {
                        console.error('Transaction error when saving consultation:', error.message);
                        reject(error);
                    });
                } catch (error) {
                    console.error('Exception when saving consultation:', error);
                    reject(error);
                }
            });
        }
        
        // Save user details to database
        function saveUserDetailsToDatabase(userData) {
            console.log('Saving user details:', userData);
            
            if (!isDbAvailable || !db) {
                console.log('Database not available, using localStorage fallback');
                
                // Generate a simple ID
                const id = Date.now();
                
                // Add timestamp
                const data = {
                    ...userData,
                    id: id,
                    created_at: new Date().toISOString()
                };
                
                // Add to local storage
                localData.users.push(data);
                
                // Save to localStorage
                try {
                    localStorage.setItem('healthconnect_data', JSON.stringify(localData));
                    console.log('Saved user details to localStorage with ID:', id);
                    return Promise.resolve(id);
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                    return Promise.reject(new Error('Error saving to localStorage: ' + e.message));
                }
            }
            
            return new Promise((resolve, reject) => {
                try {
                    db.transaction(function(tx) {
                        tx.executeSql(
                            'INSERT INTO user_details (name, email, phone) VALUES (?, ?, ?)',
                            [userData.name, userData.email, userData.phone],
                            function(tx, results) {
                                console.log('User details saved with ID:', results.insertId);
                                resolve(results.insertId);
                            },
                            function(tx, error) {
                                console.error('Error saving user details:', error.message);
                                reject(error);
                            }
                        );
                    }, 
                    function(error) {
                        console.error('Transaction error when saving user details:', error.message);
                        reject(error);
                    });
                } catch (error) {
                    console.error('Exception when saving user details:', error);
                    reject(error);
                }
            });
        }
        
        // Save appointment to database
        function saveAppointmentToDatabase(appointmentData) {
            console.log('Saving appointment data:', appointmentData);
            
            if (!isDbAvailable || !db) {
                console.log('Database not available, using localStorage fallback');
                
                // Generate a simple ID
                const id = Date.now();
                
                // Add timestamp
                const data = {
                    ...appointmentData,
                    id: id,
                    created_at: new Date().toISOString()
                };
                
                // Add to local storage
                localData.appointments.push(data);
                
                // Save to localStorage
                try {
                    localStorage.setItem('healthconnect_data', JSON.stringify(localData));
                    console.log('Saved appointment to localStorage with ID:', id);
                    return Promise.resolve(id);
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                    return Promise.reject(new Error('Error saving to localStorage: ' + e.message));
                }
            }
            
            return new Promise((resolve, reject) => {
                try {
                    db.transaction(function(tx) {
                        tx.executeSql(
                            'INSERT INTO appointments (date, time, specialty) VALUES (?, ?, ?)',
                            [
                                appointmentData.date,
                                appointmentData.time,
                                appointmentData.specialty
                            ],
                            function(tx, results) {
                                console.log('Appointment saved with ID:', results.insertId);
                                resolve(results.insertId);
                            },
                            function(tx, error) {
                                console.error('Error saving appointment:', error.message);
                                reject(error);
                            }
                        );
                    },
                    function(error) {
                        console.error('Transaction error when saving appointment:', error.message);
                        reject(error);
                    });
                } catch (error) {
                    console.error('Exception when saving appointment:', error);
                    reject(error);
                }
            });
        }
        
        // Save insurance verification to database
        function saveInsuranceToDatabase(provider, id, verified) {
            const insuranceData = { provider, member_id: id, verified };
            console.log('Saving insurance verification:', insuranceData);
            
            if (!isDbAvailable || !db) {
                console.log('Database not available, using localStorage fallback');
                
                // Generate a simple ID
                const recordId = Date.now();
                
                // Add timestamp
                const data = {
                    ...insuranceData,
                    id: recordId,
                    created_at: new Date().toISOString()
                };
                
                // Add to local storage
                localData.insurance.push(data);
                
                // Save to localStorage
                try {
                    localStorage.setItem('healthconnect_data', JSON.stringify(localData));
                    console.log('Saved insurance to localStorage with ID:', recordId);
                    return Promise.resolve(recordId);
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                    return Promise.reject(new Error('Error saving to localStorage: ' + e.message));
                }
            }
            
            return new Promise((resolve, reject) => {
                try {
                    db.transaction(function(tx) {
                        tx.executeSql(
                            'INSERT INTO insurance (provider, member_id, verified) VALUES (?, ?, ?)',
                            [provider, id, verified ? 1 : 0],
                            function(tx, results) {
                                console.log('Insurance verification saved with ID:', results.insertId);
                                resolve(results.insertId);
                            },
                            function(tx, error) {
                                console.error('Error saving insurance verification:', error.message);
                                reject(error);
                            }
                        );
                    },
                    function(error) {
                        console.error('Transaction error when saving insurance verification:', error.message);
                        reject(error);
                    });
                } catch (error) {
                    console.error('Exception when saving insurance verification:', error);
                    reject(error);
                }
            });
        }
        
        // Initialize Google Maps
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 0, lng: 0 },
                zoom: 2,
                styles: [
                    {
                        featureType: "poi",
                        elementType: "labels",
                        stylers: [{ visibility: "off" }]
                    }
                ]
            });
        }
        
        // Fetch user's location
        function fetchUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        updateLocationInfo(userLocation);
                        
                        // Center the map on user's location
                        if (map) {
                            map.setCenter(userLocation);
                            map.setZoom(15);
                            
                            // Add marker for user's location
                            new google.maps.Marker({
                                position: userLocation,
                                map: map,
                                title: "Your Location",
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 10,
                                    fillColor: "#3498db",
                                    fillOpacity: 0.8,
                                    strokeColor: "white",
                                    strokeWeight: 2
                                }
                            });
                        }
                        
                        // Fetch address using reverse geocoding
                        fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${userLocation.lat},${userLocation.lng}&key=AIzaSyA9E2aFacB3bdzlXLedlnVOk6tG_XIsVBA`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.results && data.results.length > 0) {
                                    const address = data.results[0].formatted_address;
                                    document.getElementById('location-info').innerHTML = `
                                        <strong>Your Location:</strong> ${address}<br>
                                        <strong>Coordinates:</strong> ${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)}
                                    `;
                                }
                            })
                            .catch(error => {
                                console.error('Error fetching address:', error);
                                showAlert('Error fetching your address. Please try again.', 'danger');
                            });
                    },
                    (error) => {
                        console.error('Error getting location:', error);
                        document.getElementById('location-info').innerHTML = 'Error getting your location. Please enable location services.';
                        showAlert('Location services are disabled. Some features may not work properly.', 'info');
                    }
                );
            } else {
                document.getElementById('location-info').innerHTML = 'Your browser does not support geolocation.';
                showAlert('Your browser does not support geolocation. Some features may not work properly.', 'info');
            }
        }
        
        // Update location info
        function updateLocationInfo(location) {
            document.getElementById('location-info').innerHTML = `
                <strong>Location detected:</strong><br>
                Latitude: ${location.lat.toFixed(6)}<br>
                Longitude: ${location.lng.toFixed(6)}<br>
                <em>Fetching address...</em>
            `;
        }
        
        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('problem').value = transcript;
                    document.getElementById('voice-btn').innerHTML = '<i class="fas fa-microphone"></i>';
                    document.getElementById('voice-btn').classList.remove('pulse');
                    isListening = false;
                    
                    // Automatically search for videos
                    searchVideos(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    document.getElementById('voice-btn').innerHTML = '<i class="fas fa-microphone"></i>';
                    document.getElementById('voice-btn').classList.remove('pulse');
                    isListening = false;
                    showAlert('Error with voice input. Please try again or type your query.', 'danger');
                };
                
                recognition.onend = function() {
                    document.getElementById('voice-btn').innerHTML = '<i class="fas fa-microphone"></i>';
                    document.getElementById('voice-btn').classList.remove('pulse');
                    isListening = false;
                };
            } else {
                document.getElementById('voice-btn').style.display = 'none';
                showAlert('Your browser does not support voice input.', 'info');
            }
        }
        
        // Initialize event listeners
        function initEventListeners() {
            // Language selector
            document.getElementById('language-select').addEventListener('change', function(e) {
                const newLang = e.target.value;
                console.log('Language selected:', newLang);
                currentLanguage = newLang;
                
                // Save the language preference
                try {
                    localStorage.setItem('preferred_language', newLang);
                } catch (e) {
                    console.error('Error saving language preference:', e);
                }
                
                // Force UI update
                setTimeout(() => {
                    updateUILanguage();
                    
                    // Show language change message
                    showAlert(`Language changed to ${e.target.options[e.target.selectedIndex].text}`, 'info');
                }, 50);
                
                // Configure speech recognition language
                if (recognition) {
                    switch(newLang) {
                        case 'hi': recognition.lang = 'hi-IN'; break;
                        case 'bn': recognition.lang = 'bn-IN'; break;
                        case 'te': recognition.lang = 'te-IN'; break;
                        case 'ta': recognition.lang = 'ta-IN'; break;
                        case 'mr': recognition.lang = 'mr-IN'; break;
                        case 'gu': recognition.lang = 'gu-IN'; break;
                        case 'kn': recognition.lang = 'kn-IN'; break;
                        case 'ml': recognition.lang = 'ml-IN'; break;
                        default: recognition.lang = 'en-US';
                    }
                }
            });
            
            // Refresh language button
            document.getElementById('refresh-lang').addEventListener('click', function() {
                console.log('Manually refreshing language UI');
                updateUILanguage();
                showAlert(`UI refreshed to ${document.getElementById('language-select').options[document.getElementById('language-select').selectedIndex].text}`, 'info');
            });
            
            // Voice input button
            document.getElementById('voice-btn').addEventListener('click', function() {
                if (!isListening) {
                    recognition.start();
                    document.getElementById('voice-btn').innerHTML = '<i class="fas fa-stop"></i>';
                    document.getElementById('voice-btn').classList.add('pulse');
                    isListening = true;
                } else {
                    recognition.stop();
                    document.getElementById('voice-btn').innerHTML = '<i class="fas fa-microphone"></i>';
                    document.getElementById('voice-btn').classList.remove('pulse');
                    isListening = false;
                }
            });
            
            // Submit consultation request
            document.getElementById('submit-btn').addEventListener('click', function() {
                console.log('Submit button clicked');
                const form = document.getElementById('name').closest('form');
                
                // Check if the parent form exists
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault(); // Prevent standard form submission
                    });
                }

                // Get form values with error handling
                let fullName, email, phone, problem;
                try {
                    fullName = document.getElementById('name').value.trim();
                    email = document.getElementById('email').value.trim();
                    phone = document.getElementById('phone').value.trim();
                    problem = document.getElementById('problem').value.trim();
                    
                    console.log('Form data collected:', { fullName, email, phone, problem });
                } catch (error) {
                    console.error('Error getting form values:', error);
                    showAlert('Error accessing form fields. Please try again.', 'danger');
                    return;
                }
                
                // Validate inputs
                if (!fullName || !email || !phone || !problem) {
                    showAlert(getTranslation('fillAllFields'), 'danger');
                    return;
                }
                
                // Show loading state
                document.getElementById('submit-btn').disabled = true;
                document.getElementById('submit-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
                
                // Create the data object
                const consultationData = {
                    fullName,
                    email,
                    phone,
                    problem,
                    location: userLocation ? userLocation.address : null,
                    latitude: userLocation ? userLocation.lat : null,
                    longitude: userLocation ? userLocation.lng : null
                };
                
                console.log('Sending data to backend:', JSON.stringify(consultationData));
                
                // Send to server with explicit error handling
                fetch('/api/telehealth/consultation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(consultationData)
                })
                .then(response => {
                    console.log('Server response:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    return response.json();
                })
                .then(data => {
                    console.log('Server success response:', data);
                    
                    // Reset button state
                    document.getElementById('submit-btn').disabled = false;
                    document.getElementById('submit-btn').innerHTML = getTranslation('submitRequest');
                    
                    if (data.success) {
                        // Show success message
                        const message = getTranslation('requestSubmitted').replace('{id}', data.requestId);
                        showAlert(message, 'success');
                        
                        // Clear form
                        document.getElementById('name').value = '';
                        document.getElementById('email').value = '';
                        document.getElementById('phone').value = '';
                        document.getElementById('problem').value = '';
                        
                        // For backup, also store locally
                        saveConsultationLocally(consultationData, data.consultationId);
                    } else {
                        showAlert(data.message || 'Unknown server error', 'danger');
                        console.error('Server returned error:', data);
                    }
                })
                .catch(error => {
                    console.error('Error submitting consultation:', error);
                    
                    // Reset button state
                    document.getElementById('submit-btn').disabled = false;
                    document.getElementById('submit-btn').innerHTML = getTranslation('submitRequest');
                    
                    // Show error and save locally
                    showAlert('Error submitting consultation: ' + error.message, 'danger');
                    saveConsultationLocally(consultationData);
                    showAlert('Your request was saved locally and will be submitted when connection is restored', 'info');
                });
            });
            
            // SOS button
            document.getElementById('sos-btn').addEventListener('click', function() {
                sendSOSAlert();
            });
            
            // Schedule appointment button
            document.getElementById('schedule-btn').addEventListener('click', function() {
                scheduleAppointment();
            });
            
            // Problem description input - search for videos when typing stops
            let typingTimer;
            document.getElementById('problem').addEventListener('keyup', function() {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(function() {
                    searchVideos(document.getElementById('problem').value);
                }, 1000);
            });
            
            // Admin panel toggle (press Ctrl+Shift+A to open)
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    toggleAdminPanel();
                }
            });
            
            // Admin panel close button
            document.getElementById('admin-close').addEventListener('click', function() {
                toggleAdminPanel(false);
            });
            
            // Admin tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchAdminTab(tabId);
                });
            });
            
            // Refresh buttons
            document.getElementById('refresh-users').addEventListener('click', function() {
                loadUserData();
            });
            
            document.getElementById('refresh-consultations').addEventListener('click', function() {
                loadConsultationData();
            });
            
            document.getElementById('refresh-appointments').addEventListener('click', function() {
                loadAppointmentData();
            });
            
            document.getElementById('refresh-insurance').addEventListener('click', function() {
                loadInsuranceData();
            });
            
            // Clear data buttons
            document.getElementById('clear-users').addEventListener('click', function() {
                clearTableData('user_details');
            });
            
            document.getElementById('clear-consultations').addEventListener('click', function() {
                clearTableData('consultations');
            });
            
            document.getElementById('clear-appointments').addEventListener('click', function() {
                clearTableData('appointments');
            });
            
            document.getElementById('clear-insurance').addEventListener('click', function() {
                clearTableData('insurance');
            });
        }
        
        // Initialize chatbot
        function initChatbot() {
            const chatbotContainer = document.getElementById('chatbot-container');
            const chatbotHeader = document.getElementById('chatbot-header');
            const chatbotToggle = document.getElementById('chatbot-toggle');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotSend = document.getElementById('chatbot-send');
            const chatbotBody = document.getElementById('chatbot-body');
            
            // Toggle chatbot visibility
            chatbotHeader.addEventListener('click', function() {
                chatbotContainer.classList.toggle('chatbot-hidden');
                const icon = chatbotToggle.querySelector('i');
                if (chatbotContainer.classList.contains('chatbot-hidden')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            });
            
            // Send message using button
            chatbotSend.addEventListener('click', function() {
                sendChatbotMessage();
            });
            
            // Send message using Enter key
            chatbotInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatbotMessage();
                }
            });
            
            // Function to send message
            function sendChatbotMessage() {
                const message = chatbotInput.value.trim();
                if (message) {
                    console.log('Sending message to chatbot:', message);
                    
                    // Add user message to chat
                    addMessageToChat(message, 'user');
                    
                    // Clear input
                    chatbotInput.value = '';
                    
                    // Save user message to backend database
                    saveChatMessageToBackend(message, 'user')
                        .then(() => {
                            // Get response from bot
                            getChatbotResponse(message);
                        })
                        .catch(error => {
                            console.error('Error saving user message:', error);
                            // Continue with chatbot response even if saving fails
                            getChatbotResponse(message);
                        });
                }
            }
            
            // Save chat message to backend
            function saveChatMessageToBackend(message, sender, isError = false, errorDetails = null) {
                console.log(`Saving ${sender} message to backend:`, message);
                
                return fetch('/api/telehealth/chatlog', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        sender: sender,
                        timestamp: new Date().toISOString(),
                        isError: isError,
                        errorDetails: errorDetails
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Message saved to backend:', data);
                    return data;
                })
                .catch(error => {
                    console.error('Error saving chat message to backend:', error);
                    throw error;
                });
            }
            
            // Add message to chat
            function addMessageToChat(message, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message');
                messageElement.classList.add(sender + '-message');
                messageElement.textContent = message;
                chatbotBody.appendChild(messageElement);
                
                // Scroll to bottom
                chatbotBody.scrollTop = chatbotBody.scrollHeight;
            }
            
            // Get response from chatbot
            function getChatbotResponse(message) {
                // Add typing indicator
                const typingIndicator = document.createElement('div');
                typingIndicator.classList.add('chat-message', 'bot-message', 'typing-indicator');
                typingIndicator.innerHTML = '<span>Typing</span><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>';
                chatbotBody.appendChild(typingIndicator);
                
                // Scroll to bottom
                chatbotBody.scrollTop = chatbotBody.scrollHeight;
                
                // Call Gemini API for response
                fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyC44YtQYbgrPgMx8YHUIps0HzPAKFx3c54', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `You are a medical assistant chatbot called HealthBot. You are knowledgeable about health and medical topics. Respond concisely and professionally to the following health-related query. Limit your response to 3-4 sentences. If it's a medical emergency, advise seeking immediate care. User query: ${message}`
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 1024,
                        },
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            }
                        ]
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Remove typing indicator
                    chatbotBody.removeChild(typingIndicator);
                    
                    // Extract response text from Gemini API
                    let responseText = '';
                    try {
                        if (data.candidates && data.candidates[0] && data.candidates[0].content && 
                            data.candidates[0].content.parts && data.candidates[0].content.parts[0]) {
                            responseText = data.candidates[0].content.parts[0].text;
                        } else {
                            console.error('Unexpected API response structure:', data);
                            throw new Error('Unexpected API response structure');
                        }
                    } catch (error) {
                        console.error('Error parsing API response:', error);
                        responseText = 'I apologize, but I encountered an issue processing your request. Could you please try again?';
                    }
                    
                    // Add response to chat
                    addMessageToChat(responseText, 'bot');
                    
                    // Save bot response to database
                    saveChatMessageToBackend(responseText, 'bot')
                        .catch(error => {
                            console.error('Error saving bot response to database:', error);
                        });
                })
                .catch(error => {
                    console.error('Error fetching from Gemini API:', error);
                    
                    // Remove typing indicator
                    chatbotBody.removeChild(typingIndicator);
                    
                    // Fallback response with more specific error information
                    let fallbackResponse = 'I apologize, but I encountered an issue connecting to my knowledge base. ';
                    
                    // Check for specific error types
                    if (error.message.includes('Failed to fetch')) {
                        fallbackResponse += 'It seems there might be a network connectivity issue. ';
                    } else if (error.message.includes('401') || error.message.includes('403')) {
                        fallbackResponse += 'There appears to be an authentication issue. ';
                    }
                    
                    // Add context-specific fallback
                    const lowerMessage = message.toLowerCase();
                    if (lowerMessage.includes('appointment') || lowerMessage.includes('schedule')) {
                        fallbackResponse += 'To schedule an appointment, please fill out the Quick Schedule form on the right side of the page.';
                    } else if (lowerMessage.includes('emergency') || lowerMessage.includes('urgent')) {
                        fallbackResponse += 'If you have a medical emergency, please call 911 immediately or use the SOS button to alert emergency services.';
                    } else if (lowerMessage.includes('prescription') || lowerMessage.includes('medication')) {
                        fallbackResponse += 'You can view your current prescriptions in the Prescriptions section. For refills, please contact your doctor directly.';
                    } else {
                        fallbackResponse += 'Please try again later or contact customer support if the issue persists.';
                    }
                    
                    addMessageToChat(fallbackResponse, 'bot');
                    
                    // Save fallback response to database
                    saveChatMessageToBackend(fallbackResponse, 'bot', true, error.message)
                        .catch(saveError => {
                            console.error('Error saving fallback response to database:', saveError);
                        });
                });
            }
        }
        
        // Save consultation data to local storage
        function saveConsultationLocally(consultationData, id = null) {
            try {
                console.log('Saving consultation locally with ID:', id || 'auto-generated');
                
                // Get existing consultations or initialize empty array
                let consultations = [];
                
                try {
                    const storedConsultations = localStorage.getItem('telehealth_consultations');
                    if (storedConsultations) {
                        consultations = JSON.parse(storedConsultations);
                        if (!Array.isArray(consultations)) {
                            console.warn('Stored consultations is not an array, resetting');
                            consultations = [];
                        }
                    }
                } catch (parseError) {
                    console.error('Error parsing stored consultations:', parseError);
                    consultations = [];
                }
                
                // Add consultation with timestamp and ID
                const consultation = {
                    ...consultationData,
                    id: id || 'local-' + Date.now(),
                    timestamp: new Date().toISOString(),
                    status: 'pending',
                    syncStatus: id ? 'synced' : 'pending'
                };
                
                consultations.push(consultation);
                
                // Save back to local storage
                localStorage.setItem('telehealth_consultations', JSON.stringify(consultations));
                console.log('Consultation saved locally, total count:', consultations.length);
                
                return true;
            } catch (error) {
                console.error('Error saving consultation locally:', error);
                // Try alternative storage method if localStorage fails
                try {
                    if (window.sessionStorage) {
                        sessionStorage.setItem('last_consultation', JSON.stringify({
                            ...consultationData,
                            id: id || 'session-' + Date.now(),
                            timestamp: new Date().toISOString(),
                        }));
                        console.log('Consultation saved to session storage as fallback');
                    }
                } catch (fallbackError) {
                    console.error('Failed to save to session storage:', fallbackError);
                }
                return false;
            }
        }
        
        // Send SOS alert
        function sendSOSAlert() {
            // Confirm the action
            if (!confirm(getTranslation('sosConfirm'))) {
                return;
            }
            
            // Get user details - use what we have available
            const fullName = document.getElementById('name').value.trim() || 'Anonymous User';
            const phone = document.getElementById('phone').value.trim() || 'Not provided';
            
            // Prepare SOS data
            const sosData = {
                fullName,
                phone,
                location: userLocation ? userLocation.address : 'Unknown location',
                latitude: userLocation ? userLocation.lat : null,
                longitude: userLocation ? userLocation.lng : null
            };
            
            // Show loading state
            document.getElementById('sos-btn').disabled = true;
            document.getElementById('sos-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending Alert...';
            document.getElementById('sos-btn').classList.add('pulse');
            
            // Send to server
            fetch('/api/telehealth/sos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(sosData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    showAlert(getTranslation('sosSent'), 'success');
                    
                    // Additional emergency alert
                    setTimeout(() => {
                        showAlert(getTranslation('emergencyAlert'), 'danger');
                        
                        // Show specific details if available
                        if (data.estimatedResponseTime) {
                            showAlert(`Estimated response time: ${data.estimatedResponseTime}`, 'info');
                        }
                        if (data.instructions) {
                            showAlert(`Instructions: ${data.instructions}`, 'info');
                        }
                    }, 2000);
                    
                    // Change button style but keep it disabled
                    document.getElementById('sos-btn').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Alert Sent';
                    document.getElementById('sos-btn').style.backgroundColor = '#e74c3c';
                    // Keep it disabled until page refresh
                } else {
                    // Reset button and show error
                    document.getElementById('sos-btn').disabled = false;
                    document.getElementById('sos-btn').innerHTML = 'Send SOS Alert';
                    document.getElementById('sos-btn').classList.remove('pulse');
                    
                    showAlert('Error sending SOS alert: ' + data.message, 'danger');
                }
                })
                .catch(error => {
                // Reset button and show error
                document.getElementById('sos-btn').disabled = false;
                document.getElementById('sos-btn').innerHTML = 'Send SOS Alert';
                document.getElementById('sos-btn').classList.remove('pulse');
                
                console.error('Error:', error);
                showAlert('Error sending SOS alert. Please call emergency services directly.', 'danger');
            });
        }
        
        // Schedule appointment
        function scheduleAppointment() {
            const date = document.getElementById('appointment-date').value;
            const time = document.getElementById('appointment-time').value;
            const specialty = document.getElementById('doctor-specialty').value;
            
            // Validate inputs
            if (!date || !time || !specialty) {
                showAlert(getTranslation('selectDateTime'), 'danger');
                return;
            }
            
            // Check if date and time are in the future
            const appointmentDate = new Date(`${date}T${time}`);
            const now = new Date();
            if (appointmentDate <= now) {
                showAlert(getTranslation('selectFutureDate'), 'danger');
                return;
            }
            
            // Validate user details
            if (!fullName || !email || !phone) {
                showAlert(getTranslation('fillAllFields'), 'danger');
                return;
            }
            
            // Prepare data
            const appointmentData = {
                date,
                time,
                specialty,
                fullName,
                email,
                phone
            };
            
            // Show loading state
            document.getElementById('schedule-btn').disabled = true;
            document.getElementById('schedule-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scheduling...';
            
            // Send to server
            fetch('/api/telehealth/appointment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(appointmentData)
            })
            .then(response => response.json())
            .then(data => {
                // Reset loading state
                document.getElementById('schedule-btn').disabled = false;
                document.getElementById('schedule-btn').innerHTML = getTranslation('scheduleAppointment');
                
                if (data.success) {
                    // Show success message
                    const message = getTranslation('appointmentScheduled').replace('{id}', data.requestId);
                    showAlert(message, 'success');
                    
                    // Clear form
                    document.getElementById('appointment-date').value = '';
                    document.getElementById('appointment-time').value = '';
                    document.getElementById('doctor-specialty').value = '';
                    
                    // Save to local storage for backup
                    saveAppointmentLocally(appointmentData, data.appointmentId);
                    
                    // Refresh admin panel data if open
                    if (document.getElementById('admin-panel').classList.contains('admin-panel-visible')) {
                        loadAppointmentData();
                    }
                } else {
                    // Show error
                    showAlert(getTranslation('appointmentError') + ': ' + data.message, 'danger');
                }
                })
                .catch(error => {
                // Reset loading state
                    document.getElementById('schedule-btn').disabled = false;
                document.getElementById('schedule-btn').innerHTML = getTranslation('scheduleAppointment');
                
                // Show error
                console.error('Error:', error);
                showAlert(getTranslation('appointmentError') + ': ' + error.message, 'danger');
                
                // Save locally as backup
                saveAppointmentLocally(appointmentData);
                });
        }
        
        // Search for health videos
        function searchVideos(query) {
            if (!query || query.trim().length < 3) {
                return;
            }
            
            query = query.trim();
            document.getElementById('video-loading').classList.remove('hidden');
            document.getElementById('video-container').innerHTML = '<div class="loading" id="video-loading"><div class="loading-spinner"></div></div>';
            
            // Simulate API call to search for videos
            setTimeout(() => {
                // Mock response - in a real app, this would be from a real API
                const mockVideos = [
                    {
                        title: 'Understanding ' + query + ' Symptoms',
                        author: 'Dr. Sarah Johnson',
                        views: '105K views',
                        embedCode: '<iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>'
                    },
                    {
                        title: 'How to Manage ' + query + ' at Home',
                        author: 'HealthConnect',
                        views: '78K views',
                        embedCode: '<iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>'
                    },
                    {
                        title: 'Medical Facts about ' + query,
                        author: 'Medical Channel',
                        views: '210K views',
                        embedCode: '<iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>'
                    }
                ];
                
                // Remove loading indicator
                document.getElementById('video-loading').classList.add('hidden');
                
                // Display videos
                const videoContainer = document.getElementById('video-container');
                videoContainer.innerHTML = '';
                
                mockVideos.forEach(video => {
                    const videoElement = document.createElement('div');
                    videoElement.classList.add('video-item');
                    videoElement.innerHTML = `
                        ${video.embedCode}
                        <div class="video-info">
                            <h4>${video.title}</h4>
                            <p>${video.author} • ${video.views}</p>
                        </div>
                    `;
                    videoContainer.appendChild(videoElement);
                });
            }, 2000);
        }
        
        // Show alert message
        function showAlert(message, type) {
            // Get the translated message key if it exists
            if (message && message.startsWith('@')) {
                const messageKey = message.substring(1);
                const t = translations[currentLanguage] || translations.en;
                
                // Check if the message has parameters to replace
                if (message.includes(':')) {
                    const parts = messageKey.split(':');
                    const key = parts[0];
                    const params = parts[1].split(',');
                    
                    let translatedMessage = t[key] || message;
                    
                    // Replace placeholders with values
                    params.forEach(param => {
                        const [placeholder, value] = param.split('=');
                        translatedMessage = translatedMessage.replace(`{${placeholder}}`, value);
                    });
                    
                    message = translatedMessage;
                } else {
                    message = t[messageKey] || message;
                }
            }
            
            const alertsContainer = document.getElementById('alerts-container');
            const alertElement = document.createElement('div');
            alertElement.classList.add('alert', 'alert-' + type);
            alertElement.textContent = message;
            alertsContainer.appendChild(alertElement);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                alertElement.remove();
            }, 5000);
        }
        
        // Load mock prescription data
        function loadPrescriptions() {
            const prescriptionList = document.getElementById('prescription-list');
            
            // Mock data - in a real app, this would come from an API
            const mockPrescriptions = [
                {
                    name: 'Amoxicillin 500mg',
                    dosage: '1 tablet, 3 times daily',
                    duration: '7 days',
                    doctor: 'Dr. Sarah Johnson',
                    note: 'Take with food. Complete the full course.'
                },
                {
                    name: 'Ibuprofen 200mg',
                    dosage: '1-2 tablets every 4-6 hours as needed',
                    duration: 'As needed for pain',
                    doctor: 'Dr. Michael Chen',
                    note: 'Do not exceed 6 tablets in 24 hours. Take with food.'
                },
                {
                    name: 'Lisinopril 10mg',
                    dosage: '1 tablet daily',
                    duration: '30 days, refillable',
                    doctor: 'Dr. Emily Rodriguez',
                    note: 'Take in the morning. Monitor blood pressure regularly.'
                }
            ];
            
            // Clear existing content
            prescriptionList.innerHTML = '';
            
            // Add prescriptions to the list
            mockPrescriptions.forEach(prescription => {
                const prescriptionElement = document.createElement('div');
                prescriptionElement.classList.add('prescription-item');
                prescriptionElement.innerHTML = `
                    <h4>${prescription.name}</h4>
                    <p><strong>Dosage:</strong> ${prescription.dosage}</p>
                    <p><strong>Duration:</strong> ${prescription.duration}</p>
                    <p><strong>Prescribed by:</strong> ${prescription.doctor}</p>
                    <p class="doctor-note">${prescription.note}</p>
                `;
                prescriptionList.appendChild(prescriptionElement);
            });
        }
        
        // Initialize update vitals functionality
        function initUpdateVitals() {
            document.getElementById('update-vitals-btn').addEventListener('click', function() {
                // Simulate updating vitals
                document.getElementById('update-vitals-btn').disabled = true;
                document.getElementById('update-vitals-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
                
                // Simulate delay
                setTimeout(() => {
                    // Update vitals with random values
                    const systolic = Math.floor(Math.random() * 30) + 110;
                    const diastolic = Math.floor(Math.random() * 20) + 70;
                    const heartRate = Math.floor(Math.random() * 20) + 65;
                    const oxygen = Math.floor(Math.random() * 4) + 96;
                    const temp = (Math.random() * 1 + 97.6).toFixed(1);
                    
                    // Get current time
                    const now = new Date();
                    const hours = now.getHours();
                    const minutes = now.getMinutes();
                    const ampm = hours >= 12 ? 'PM' : 'AM';
                    const formattedHours = hours % 12 || 12;
                    const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
                    const timeString = `Today, ${formattedHours}:${formattedMinutes} ${ampm}`;
                    
                    // Update the display
                    const vitalsContainer = document.querySelector('.vitals-container');
                    vitalsContainer.innerHTML = `
                        <div class="vital-item">
                            <span>Blood Pressure:</span>
                            <span>${systolic}/${diastolic} mmHg</span>
                        </div>
                        <div class="vital-item">
                            <span>Heart Rate:</span>
                            <span>${heartRate} BPM</span>
                        </div>
                        <div class="vital-item">
                            <span>Oxygen Saturation:</span>
                            <span>${oxygen}%</span>
                        </div>
                        <div class="vital-item">
                            <span>Temperature:</span>
                            <span>${temp}°F</span>
                        </div>
                        <div class="vital-item">
                            <span>Last Updated:</span>
                            <span>${timeString}</span>
                        </div>
                    `;
                    
                    // Re-enable button
                    document.getElementById('update-vitals-btn').disabled = false;
                    document.getElementById('update-vitals-btn').innerHTML = '<i class="fas fa-sync-alt"></i> Update Vitals';
                    
                    // Show success message
                    showAlert('Vitals updated successfully!', 'success');
                }, 2000);
            });
        }
        
        // Initialize insurance verification
        function initInsuranceVerification() {
            document.getElementById('verify-insurance-btn').addEventListener('click', function() {
                const provider = document.getElementById('insurance-provider').value.trim();
                const id = document.getElementById('insurance-id').value.trim();
                
                // Validate inputs
                if (!provider || !id) {
                    showAlert(getTranslation('verifyError'), 'danger');
                    return;
                }
                
                // Disable button and show loading state
                document.getElementById('verify-insurance-btn').disabled = true;
                document.getElementById('verify-insurance-btn').textContent = 'Verifying...';
                
                console.log('Starting insurance verification process');
                
                // Fallback timer to prevent eternal loading state
                const loadingTimeout = setTimeout(() => {
                    document.getElementById('verify-insurance-btn').disabled = false;
                    document.getElementById('verify-insurance-btn').textContent = translations[currentLanguage].verifyCoverage || 'Verify Coverage';
                    showAlert('Verification is taking longer than expected. Please try again.', 'warning');
                }, 8000);
                
                // Randomly determine if coverage is verified (for demo purposes)
                const isVerified = Math.random() > 0.3;
                
                // Save to database with better error handling
                saveInsuranceToDatabase(provider, id, isVerified)
                    .then(id => {
                        clearTimeout(loadingTimeout);
                        console.log('Insurance verification completed successfully');
                        
                        if (isVerified) {
                            showAlert('coverageVerified:id=' + id, 'success');
                        } else {
                            showAlert('coverageNotVerified:id=' + id, 'danger');
                        }
                    })
                    .catch(error => {
                        clearTimeout(loadingTimeout);
                        console.error('Error verifying insurance:', error);
                        
                        // Show detailed error message
                        showAlert('errorSubmitting:error=' + error.message, 'danger');
                    })
                    .finally(() => {
                        // Re-enable button
                        document.getElementById('verify-insurance-btn').disabled = false;
                        document.getElementById('verify-insurance-btn').textContent = translations[currentLanguage].verifyCoverage || 'Verify Coverage';
                    });
            });
            
            // Initialize follow-up toggle
            document.getElementById('follow-up-toggle').addEventListener('change', function() {
                if (this.checked) {
                    showAlert('Automatic follow-up reminders enabled. You will receive a notification 7 days after your consultation.', 'info');
                }
            });
        }
        
        // Toggle admin panel
        function toggleAdminPanel(show) {
            const adminPanel = document.getElementById('admin-panel');
            if (show === undefined) {
                adminPanel.classList.toggle('active');
            } else {
                if (show) {
                    adminPanel.classList.add('active');
                } else {
                    adminPanel.classList.remove('active');
                }
            }
            
            if (adminPanel.classList.contains('active')) {
                // Load data for the active tab
                const activeTab = document.querySelector('.admin-tab.active').getAttribute('data-tab');
                loadDataForTab(activeTab);
            }
        }
        
        // Switch admin tab
        function switchAdminTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Update tab content
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                if (content.id === tabId + '-tab') {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            // Load data for the selected tab
            loadDataForTab(tabId);
        }
        
        // Load data for selected tab
        function loadDataForTab(tabId) {
            switch (tabId) {
                case 'user-details':
                    loadUserData();
                    break;
                case 'consultations':
                    loadConsultationData();
                    break;
                case 'appointments':
                    loadAppointmentData();
                    break;
                case 'insurance':
                    loadInsuranceData();
                    break;
            }
        }
        
        // Load user data
        function loadUserData() {
            if (!isDbAvailable || !db) {
                // Use localStorage fallback
                const tableBody = document.querySelector('#user-details-data table tbody');
                
                if (localData.users.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5">No user data found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                localData.users.forEach(row => {
                    tableBody.innerHTML += `
                        <tr>
                            <td>${row.id}</td>
                            <td>${row.name}</td>
                            <td>${row.email}</td>
                            <td>${row.phone}</td>
                            <td>${row.created_at}</td>
                        </tr>
                    `;
                });
                return;
            }
            
            const tableBody = document.querySelector('#user-details-data table tbody');
            tableBody.innerHTML = '<tr><td colspan="5">Loading data...</td></tr>';
            
            db.transaction(function(tx) {
                tx.executeSql(
                    'SELECT * FROM user_details ORDER BY id DESC',
                    [],
                    function(tx, results) {
                        if (results.rows.length === 0) {
                            tableBody.innerHTML = '<tr><td colspan="5">No user data found</td></tr>';
                            return;
                        }
                        
                        tableBody.innerHTML = '';
                        for (let i = 0; i < results.rows.length; i++) {
                            const row = results.rows.item(i);
                            tableBody.innerHTML += `
                                <tr>
                                    <td>${row.id}</td>
                                    <td>${row.name}</td>
                                    <td>${row.email}</td>
                                    <td>${row.phone}</td>
                                    <td>${row.created_at}</td>
                                </tr>
                            `;
                        }
                    },
                    function(tx, error) {
                        console.error('Error loading user data:', error.message);
                        showAdminError('user-details-data', 'Error loading user data: ' + error.message);
                    }
                );
            });
        }
        
        // Load consultation data
        function loadConsultationData() {
            const tableBody = document.querySelector('#consultations-tab tbody');
            tableBody.innerHTML = '<tr><td colspan="7"><div class="loading"><div class="loading-spinner"></div></div></td></tr>';
            
            // Fetch from server
            fetch('/api/telehealth/consultations')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.consultations.length > 0) {
                        // Clear loading state
                tableBody.innerHTML = '';
                        
                        // Add each consultation to the table
                        data.consultations.forEach(consultation => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>TC${String(consultation.id).padStart(4, '0')}</td>
                                <td>${consultation.fullName}</td>
                                <td>${consultation.email}</td>
                                <td>${consultation.phone}</td>
                                <td>${consultation.problem}</td>
                                <td>${consultation.location || 'Not provided'}</td>
                                <td>${new Date(consultation.created_at).toLocaleString()}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    } else {
                        // Show no data message
                        tableBody.innerHTML = '<tr><td colspan="7">No consultation requests found</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error loading consultations:', error);
                    tableBody.innerHTML = '<tr><td colspan="7">Error loading data: ' + error.message + '</td></tr>';
                    
                    // Try to load from local storage as fallback
                    const localConsultations = getLocalData('consultations');
                    if (localConsultations && localConsultations.length > 0) {
                        tableBody.innerHTML = '<tr><td colspan="7">Using local data (server unavailable)</td></tr>';
                        localConsultations.forEach(consultation => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${consultation.id || 'Local'}</td>
                                <td>${consultation.fullName}</td>
                                <td>${consultation.email}</td>
                                <td>${consultation.phone}</td>
                                <td>${consultation.problem}</td>
                                <td>${consultation.location || 'Not provided'}</td>
                                <td>${consultation.timestamp || 'Unknown'}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
            });
        }
        
        // Load appointment data
        function loadAppointmentData() {
            const tableBody = document.querySelector('#appointments-tab tbody');
            tableBody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="loading-spinner"></div></div></td></tr>';
            
            // Fetch from server
            fetch('/api/telehealth/appointments')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.appointments.length > 0) {
                        // Clear loading state
                tableBody.innerHTML = '';
                        
                        // Add each appointment to the table
                        data.appointments.forEach(appointment => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>TA${String(appointment.id).padStart(4, '0')}</td>
                                <td>${appointment.date}</td>
                                <td>${appointment.time}</td>
                                <td>${appointment.specialty}</td>
                                <td>${new Date(appointment.created_at).toLocaleString()}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    } else {
                        // Show no data message
                        tableBody.innerHTML = '<tr><td colspan="5">No appointments found</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error loading appointments:', error);
                    tableBody.innerHTML = '<tr><td colspan="5">Error loading data: ' + error.message + '</td></tr>';
                    
                    // Try to load from local storage as fallback
                    const localAppointments = getLocalData('appointments');
                    if (localAppointments && localAppointments.length > 0) {
                        tableBody.innerHTML = '<tr><td colspan="5">Using local data (server unavailable)</td></tr>';
                        localAppointments.forEach(appointment => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${appointment.id || 'Local'}</td>
                                <td>${appointment.date}</td>
                                <td>${appointment.time}</td>
                                <td>${appointment.specialty}</td>
                                <td>${appointment.timestamp || 'Unknown'}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
            });
        }
        
        // Load insurance data
        function loadInsuranceData() {
            const tableBody = document.querySelector('#insurance-tab tbody');
            tableBody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="loading-spinner"></div></div></td></tr>';
            
            // Fetch from server
            fetch('/api/telehealth/insurance')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.verifications.length > 0) {
                        // Clear loading state
                tableBody.innerHTML = '';
                        
                        // Add each verification to the table
                        data.verifications.forEach(verification => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>IV${String(verification.id).padStart(4, '0')}</td>
                                <td>${verification.provider}</td>
                                <td>${verification.memberId}</td>
                                <td>${verification.verified ? 'Yes' : 'No'}</td>
                                <td>${new Date(verification.created_at).toLocaleString()}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    } else {
                        // Show no data message
                        tableBody.innerHTML = '<tr><td colspan="5">No insurance verifications found</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error loading insurance verifications:', error);
                    tableBody.innerHTML = '<tr><td colspan="5">Error loading data: ' + error.message + '</td></tr>';
                    
                    // Try to load from local storage as fallback
                    const localInsurance = getLocalData('insurance');
                    if (localInsurance && localInsurance.length > 0) {
                        tableBody.innerHTML = '<tr><td colspan="5">Using local data (server unavailable)</td></tr>';
                        localInsurance.forEach(insurance => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${insurance.id || 'Local'}</td>
                                <td>${insurance.provider}</td>
                                <td>${insurance.memberId}</td>
                                <td>${insurance.verified ? 'Yes' : 'No'}</td>
                                <td>${insurance.timestamp || 'Unknown'}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
            });
        }
        
        // Clear table data
        function clearTableData(tableName) {
            if (!isDbAvailable || !db) {
                // Use localStorage fallback
                if (confirm(`Are you sure you want to delete all data from the ${tableName} table? This action cannot be undone.`)) {
                    switch(tableName) {
                        case 'user_details':
                            localData.users = [];
                            break;
                        case 'consultations':
                            localData.consultations = [];
                            break;
                        case 'appointments':
                            localData.appointments = [];
                            break;
                        case 'insurance':
                            localData.insurance = [];
                            break;
                    }// Save updated data
                    try {
                        localStorage.setItem('healthconnect_data', JSON.stringify(localData));
                        showAlert(`All data from ${tableName} has been deleted`, 'success');
                        
                        // Reload data
                        switch(tableName) {
                            case 'user_details':
                                loadUserData();
                                break;
                            case 'consultations':
                                loadConsultationData();
                                break;
                            case 'appointments':
                                loadAppointmentData();
                                break;
                            case 'insurance':
                                loadInsuranceData();
                                break;
                        }
                    } catch (e) {
                        console.error('Error saving to localStorage:', e);
                        showAlert(`Error deleting data: ${e.message}`, 'danger');
                    }
                }
                return;
            }
            
            if (confirm(`Are you sure you want to delete all data from the ${tableName} table? This action cannot be undone.`)) {
                db.transaction(function(tx) {
                    tx.executeSql(
                        `DELETE FROM ${tableName}`,
                        [],
                        function(tx, results) {
                            showAlert(`All data from ${tableName} has been deleted`, 'success');
                            // Reload data
                            switch(tableName) {
                                case 'user_details':
                                    loadUserData();
                                    break;
                                case 'consultations':
                                    loadConsultationData();
                                    break;
                                case 'appointments':
                                    loadAppointmentData();
                                    break;
                                case 'insurance':
                                    loadInsuranceData();
                                    break;
                            }
                        },
                        function(tx, error) {
                            console.error(`Error deleting data from ${tableName}:`, error.message);
                            showAlert(`Error deleting data from ${tableName}: ${error.message}`, 'danger');
                        }
                    );
                });
            }
        }
        
        // Show error in admin panel
        function showAdminError(elementId, message) {
            const container = document.getElementById(elementId);
            if (container) {
                container.innerHTML = `<div class="alert alert-danger">${message}</div>`;
            }
        }
        
        // Change language function
        function changeLanguage(lang) {
            // Directly use the setLanguage function instead
            setLanguage(lang);
            
            // Configure speech recognition language if available
            if (recognition) {
                switch(lang) {
                    case 'hi': recognition.lang = 'hi-IN'; break;
                    case 'bn': recognition.lang = 'bn-IN'; break;
                    case 'te': recognition.lang = 'te-IN'; break;
                    case 'ta': recognition.lang = 'ta-IN'; break;
                    case 'mr': recognition.lang = 'mr-IN'; break;
                    case 'gu': recognition.lang = 'gu-IN'; break;
                    case 'kn': recognition.lang = 'kn-IN'; break;
                    case 'ml': recognition.lang = 'ml-IN'; break;
                    default: recognition.lang = 'en-US';
                }
            }
        }
        
        // Update UI with translations based on the current language
        function updateUILanguage() {
            const t = translations[currentLanguage] || translations.en;
            console.log('Updating UI language to:', currentLanguage);
            
            try {
                // Navigation
                document.querySelectorAll('nav ul li a')[0].textContent = t.home;
                document.querySelectorAll('nav ul li a')[1].textContent = t.services;
                document.querySelectorAll('nav ul li a')[2].textContent = t.doctors;
                document.querySelectorAll('nav ul li a')[3].textContent = t.about;
                document.querySelectorAll('nav ul li a')[4].textContent = t.contact;
                
                // Consultation Form
                document.querySelector('.card h2 i.fas.fa-user-md').parentNode.textContent = t.telehealthConsultation;
                document.querySelector('label[for="name"]').textContent = t.fullName;
                document.getElementById('name').placeholder = t.enterFullName;
                document.querySelector('label[for="email"]').textContent = t.emailAddress;
                document.getElementById('email').placeholder = t.enterEmail;
                document.querySelector('label[for="phone"]').textContent = t.phoneNumber;
                document.getElementById('phone').placeholder = t.enterPhone;
                document.querySelector('label[for="problem"]').textContent = t.healthIssue;
                document.getElementById('problem').placeholder = t.healthConcerns;
                document.getElementById('submit-btn').textContent = t.submitRequest;
                
                // Insurance Form
                document.querySelector('.insurance-form h3 i.fas.fa-id-card').parentNode.textContent = t.insuranceVerification;
                document.querySelector('label[for="insurance-provider"]').textContent = t.insuranceProvider;
                document.getElementById('insurance-provider').placeholder = t.enterInsurance;
                document.querySelector('label[for="insurance-id"]').textContent = t.memberId;
                document.getElementById('insurance-id').placeholder = t.enterMemberId;
                document.getElementById('verify-insurance-btn').textContent = t.verifyCoverage;
                document.querySelector('.follow-up-toggle span').textContent = t.followUpReminder;
                
                // Quick Schedule
                document.querySelector('.card h2 i.fas.fa-calendar-alt').parentNode.textContent = t.quickSchedule;
                document.querySelector('label[for="appointment-date"]').textContent = t.preferredDate;
                document.querySelector('label[for="appointment-time"]').textContent = t.preferredTime;
                document.querySelector('label[for="doctor-specialty"]').textContent = t.doctorSpecialty;
                
                // Update specialty options
                const specialtySelect = document.getElementById('doctor-specialty');
                specialtySelect.options[0].textContent = t.selectSpecialty;
                specialtySelect.options[1].textContent = t.generalPractitioner;
                specialtySelect.options[2].textContent = t.cardiologist;
                specialtySelect.options[3].textContent = t.dermatologist;
                specialtySelect.options[4].textContent = t.neurologist;
                specialtySelect.options[5].textContent = t.pediatrician;
                specialtySelect.options[6].textContent = t.psychiatrist;
                
                document.getElementById('schedule-btn').textContent = t.scheduleAppointment;
                
                // Location Card
                document.querySelector('.card h2 i.fas.fa-map-marker-alt').parentNode.textContent = t.yourLocation;
                document.querySelector('.card h2 i.fas.fa-map-marker-alt').parentNode.nextElementSibling.textContent = t.locationDesc;
                
                if (document.getElementById('location-info').textContent.includes('Fetching')) {
                    document.getElementById('location-info').textContent = t.fetchingLocation;
                }
                
                document.getElementById('sos-btn').innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${t.sendSOS}`;
                
                // Vitals Card
                document.querySelector('.card h2 i.fas.fa-heartbeat').parentNode.textContent = t.yourVitals;
                document.querySelector('.card h2 i.fas.fa-heartbeat').parentNode.nextElementSibling.textContent = t.recentVitals;
                
                // Update vitals labels
                document.querySelectorAll('.vital-item')[0].firstElementChild.textContent = t.bloodPressure;
                document.querySelectorAll('.vital-item')[1].firstElementChild.textContent = t.heartRate;
                document.querySelectorAll('.vital-item')[2].firstElementChild.textContent = t.oxygenSaturation;
                document.querySelectorAll('.vital-item')[3].firstElementChild.textContent = t.temperature;
                document.querySelectorAll('.vital-item')[4].firstElementChild.textContent = t.lastUpdated;
                
                document.getElementById('update-vitals-btn').innerHTML = `<i class="fas fa-sync-alt"></i> ${t.updateVitals}`;
                
                // Chatbot
                document.querySelector('.chatbot-header h3').textContent = t.healthbot;
                
                // Replace initial bot message if it's the greeting
                const botMessages = document.querySelectorAll('.bot-message');
                if (botMessages.length === 1 && botMessages[0].textContent.includes("I'm HealthBot")) {
                    botMessages[0].textContent = t.chatbotGreeting;
                }
                
                document.getElementById('chatbot-input').placeholder = t.typeMessage;
                
                // Admin Panel
                document.querySelector('.admin-header h2').textContent = t.adminTitle;
                document.getElementById('admin-close').textContent = t.closeButton;
                
                // Admin tabs
                document.querySelectorAll('.admin-tab')[0].textContent = t.userDetailsTab;
                document.querySelectorAll('.admin-tab')[1].textContent = t.consultationsTab;
                document.querySelectorAll('.admin-tab')[2].textContent = t.appointmentsTab;
                document.querySelectorAll('.admin-tab')[3].textContent = t.insuranceTab;
                
                // Table headers - User Details
                const userTable = document.querySelector('#user-details-data table thead tr');
                if (userTable) {
                    userTable.children[0].textContent = t.thId;
                    userTable.children[1].textContent = t.thName;
                    userTable.children[2].textContent = t.thEmail;
                    userTable.children[3].textContent = t.thPhone;
                    userTable.children[4].textContent = t.thCreatedAt;
                }
                
                // Table headers - Consultations
                const consultTable = document.querySelector('#consultations-data table thead tr');
                if (consultTable) {
                    consultTable.children[0].textContent = t.thId;
                    consultTable.children[1].textContent = t.thName;
                    consultTable.children[2].textContent = t.thEmail;
                    consultTable.children[3].textContent = t.thPhone;
                    consultTable.children[4].textContent = t.thProblem;
                    consultTable.children[5].textContent = t.thLocation;
                    consultTable.children[6].textContent = t.thCreatedAt;
                }
                
                // Table headers - Appointments
                const appointmentTable = document.querySelector('#appointments-data table thead tr');
                if (appointmentTable) {
                    appointmentTable.children[0].textContent = t.thId;
                    appointmentTable.children[1].textContent = t.thDate;
                    appointmentTable.children[2].textContent = t.thTime;
                    appointmentTable.children[3].textContent = t.thSpecialty;
                    appointmentTable.children[4].textContent = t.thCreatedAt;
                }
                
                // Table headers - Insurance
                const insuranceTable = document.querySelector('#insurance-data table thead tr');
                if (insuranceTable) {
                    insuranceTable.children[0].textContent = t.thId;
                    insuranceTable.children[1].textContent = t.thProvider;
                    insuranceTable.children[2].textContent = t.thMemberId;
                    insuranceTable.children[3].textContent = t.thVerified;
                    insuranceTable.children[4].textContent = t.thCreatedAt;
                }
                
                // Admin section headings
                document.querySelector('#user-details-tab .data-controls h3').textContent = t.registeredUsers;
                document.querySelector('#consultations-tab .data-controls h3').textContent = t.consultationRequests;
                document.querySelector('#appointments-tab .data-controls h3').textContent = t.scheduledAppointments;
                document.querySelector('#insurance-tab .data-controls h3').textContent = t.insuranceVerifications;
                
                // Admin buttons
                document.querySelectorAll('.refresh-btn').forEach(btn => {
                    btn.innerHTML = `<i class="fas fa-sync-alt"></i> ${t.refreshButton}`;
                });
                
                document.querySelectorAll('.clear-btn').forEach(btn => {
                    btn.innerHTML = `<i class="fas fa-trash-alt"></i> ${t.clearDataButton}`;
                });
            } catch (error) {
                console.error('Error changing language:', error);
            }
        }

        function setLanguage(lang) {
            try {
                currentLanguage = lang;
                
                // Save the language preference
                try {
                    localStorage.setItem('preferred_language', lang);
                } catch (e) {
                    console.error('Error saving language preference:', e);
                }
                
                // Get translations for the selected language
                const t = translations[lang] || translations.en;
                
                console.log('Directly setting language to:', lang);
                
                // Navigation
                document.querySelectorAll('nav ul li a')[0].textContent = t.home;
                document.querySelectorAll('nav ul li a')[1].textContent = t.services;
                document.querySelectorAll('nav ul li a')[2].textContent = t.doctors;
                document.querySelectorAll('nav ul li a')[3].textContent = t.about;
                document.querySelectorAll('nav ul li a')[4].textContent = t.contact;
                
                // Consultation Form
                const consultHeading = document.querySelector('.card h2 i.fas.fa-user-md').parentNode;
                consultHeading.innerHTML = `<i class="fas fa-user-md"></i> ${t.telehealthConsultation}`;
                
                document.querySelector('label[for="name"]').textContent = t.fullName;
                document.getElementById('name').placeholder = t.enterFullName;
                document.querySelector('label[for="email"]').textContent = t.emailAddress;
                document.getElementById('email').placeholder = t.enterEmail;
                document.querySelector('label[for="phone"]').textContent = t.phoneNumber;
                document.getElementById('phone').placeholder = t.enterPhone;
                document.querySelector('label[for="problem"]').textContent = t.healthIssue;
                document.getElementById('problem').placeholder = t.healthConcerns;
                document.getElementById('submit-btn').textContent = t.submitRequest;
                
                // Insurance Form
                const insuranceHeading = document.querySelector('.insurance-form h3 i.fas.fa-id-card').parentNode;
                insuranceHeading.innerHTML = `<i class="fas fa-id-card"></i> ${t.insuranceVerification}`;
                
                document.querySelector('label[for="insurance-provider"]').textContent = t.insuranceProvider;
                document.getElementById('insurance-provider').placeholder = t.enterInsurance;
                document.querySelector('label[for="insurance-id"]').textContent = t.memberId;
                document.getElementById('insurance-id').placeholder = t.enterMemberId;
                document.getElementById('verify-insurance-btn').textContent = t.verifyCoverage;
                document.querySelector('.follow-up-toggle span').textContent = t.followUpReminder;
                
                // Quick Schedule
                const scheduleHeading = document.querySelector('.card h2 i.fas.fa-calendar-alt').parentNode;
                scheduleHeading.innerHTML = `<i class="fas fa-calendar-alt"></i> ${t.quickSchedule}`;
                
                document.querySelector('label[for="appointment-date"]').textContent = t.preferredDate;
                document.querySelector('label[for="appointment-time"]').textContent = t.preferredTime;
                document.querySelector('label[for="doctor-specialty"]').textContent = t.doctorSpecialty;
                
                // Update specialty options
                const specialtySelect = document.getElementById('doctor-specialty');
                specialtySelect.options[0].textContent = t.selectSpecialty;
                specialtySelect.options[1].textContent = t.generalPractitioner;
                specialtySelect.options[2].textContent = t.cardiologist;
                specialtySelect.options[3].textContent = t.dermatologist;
                specialtySelect.options[4].textContent = t.neurologist;
                specialtySelect.options[5].textContent = t.pediatrician;
                specialtySelect.options[6].textContent = t.psychiatrist;
                
                document.getElementById('schedule-btn').textContent = t.scheduleAppointment;
                
                // Location Card
                const locationHeading = document.querySelector('.card h2 i.fas.fa-map-marker-alt').parentNode;
                locationHeading.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${t.yourLocation}`;
                
                locationHeading.nextElementSibling.textContent = t.locationDesc;
                
                if (document.getElementById('location-info').textContent.includes('Fetching')) {
                    document.getElementById('location-info').textContent = t.fetchingLocation;
                }
                
                document.getElementById('sos-btn').innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${t.sendSOS}`;
                
                // Vitals Card
                const vitalsHeading = document.querySelector('.card h2 i.fas.fa-heartbeat').parentNode;
                vitalsHeading.innerHTML = `<i class="fas fa-heartbeat"></i> ${t.yourVitals}`;
                
                vitalsHeading.nextElementSibling.textContent = t.recentVitals;
                
                // Update vitals labels
                document.querySelectorAll('.vital-item')[0].firstElementChild.textContent = t.bloodPressure;
                document.querySelectorAll('.vital-item')[1].firstElementChild.textContent = t.heartRate;
                document.querySelectorAll('.vital-item')[2].firstElementChild.textContent = t.oxygenSaturation;
                document.querySelectorAll('.vital-item')[3].firstElementChild.textContent = t.temperature;
                document.querySelectorAll('.vital-item')[4].firstElementChild.textContent = t.lastUpdated;
                
                document.getElementById('update-vitals-btn').innerHTML = `<i class="fas fa-sync-alt"></i> ${t.updateVitals}`;
                
                // Chatbot
                document.querySelector('.chatbot-header h3').innerHTML = `<i class="fas fa-robot"></i> ${t.healthbot}`;
                
                // Replace initial bot message if it's the greeting
                const botMessages = document.querySelectorAll('.bot-message');
                if (botMessages.length === 1 && botMessages[0].textContent.includes("I'm HealthBot")) {
                    botMessages[0].textContent = t.chatbotGreeting;
                }
                
                document.getElementById('chatbot-input').placeholder = t.typeMessage;
                
                // Admin Panel
                document.querySelector('.admin-header h2').innerHTML = `<i class="fas fa-database"></i> ${t.adminTitle}`;
                document.getElementById('admin-close').textContent = t.closeButton;
                
                // Admin tabs
                document.querySelectorAll('.admin-tab')[0].textContent = t.userDetailsTab;
                document.querySelectorAll('.admin-tab')[1].textContent = t.consultationsTab;
                document.querySelectorAll('.admin-tab')[2].textContent = t.appointmentsTab;
                document.querySelectorAll('.admin-tab')[3].textContent = t.insuranceTab;
                
                // Admin section headings
                document.querySelector('#user-details-tab .data-controls h3').textContent = t.registeredUsers;
                document.querySelector('#consultations-tab .data-controls h3').textContent = t.consultationRequests;
                document.querySelector('#appointments-tab .data-controls h3').textContent = t.scheduledAppointments;
                document.querySelector('#insurance-tab .data-controls h3').textContent = t.insuranceVerifications;
                
                // Admin buttons
                document.querySelectorAll('.refresh-btn').forEach(btn => {
                    btn.innerHTML = `<i class="fas fa-sync-alt"></i> ${t.refreshButton}`;
                });
                
                document.querySelectorAll('.clear-btn').forEach(btn => {
                    btn.innerHTML = `<i class="fas fa-trash-alt"></i> ${t.clearDataButton}`;
                });
                
                // Show confirmation message
                showAlert(`Language changed to ${document.getElementById('language-select').options[document.getElementById('language-select').selectedIndex].text}`, 'info');
                
                console.log('Language change completed successfully');
            } catch (error) {
                console.error('Error changing language:', error);
            }
        }

        // Function to verify insurance coverage
        function verifyInsurance() {
            const provider = document.getElementById('insurance-provider').value.trim();
            const memberId = document.getElementById('member-id').value.trim();
            const followUp = document.getElementById('follow-up').checked;
            
            // Get user details from consultation form if available
            const fullName = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            
            // Validate inputs
            if (!provider || !memberId) {
                showAlert(getTranslation('verifyError'), 'danger');
                return;
            }
            
            // Prepare data
            const insuranceData = {
                provider,
                memberId,
                followUp,
                fullName,
                email
            };
            
            // Show loading state
            document.getElementById('verify-btn').disabled = true;
            document.getElementById('verify-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            
            // Send to server
            fetch('/api/telehealth/insurance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(insuranceData)
            })
            .then(response => response.json())
            .then(data => {
                // Reset loading state
                document.getElementById('verify-btn').disabled = false;
                document.getElementById('verify-btn').innerHTML = getTranslation('verifyCoverage');
                
                if (data.success) {
                    // Show appropriate message based on verification result
                    if (data.verified) {
                        const message = getTranslation('coverageVerified').replace('{id}', data.requestId);
                        showAlert(message, 'success');
                        
                        // Show coverage details if available
                        if (data.details) {
                            const detailsMessage = `Coverage Level: ${data.details.coverageLevel}, Copay: ${data.details.copay}`;
                            showAlert(detailsMessage, 'info');
                        }
                        
                        // Show follow-up message if enabled
                        if (followUp) {
                            showAlert(getTranslation('followUpEnabled'), 'info');
                        }
                    } else {
                        const message = getTranslation('coverageNotVerified').replace('{id}', data.requestId);
                        showAlert(message, 'danger');
                    }
                    
                    // Clear form
                    document.getElementById('insurance-provider').value = '';
                    document.getElementById('member-id').value = '';
                    document.getElementById('follow-up').checked = false;
                    
                    // Save to local storage for backup
                    saveInsuranceLocally(insuranceData, data.verificationId, data.verified);
                    
                    // Refresh admin panel data if open
                    if (document.getElementById('admin-panel').classList.contains('admin-panel-visible')) {
                        loadInsuranceData();
                    }
                } else {
                    // Show error
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                // Reset loading state
                document.getElementById('verify-btn').disabled = false;
                document.getElementById('verify-btn').innerHTML = getTranslation('verifyCoverage');
                
                // Show error
                console.error('Error:', error);
                showAlert('Error verifying insurance: ' + error.message, 'danger');
                
                // Save locally as backup
                saveInsuranceLocally(insuranceData);
            });
        }

        // Save insurance verification to local storage
        function saveInsuranceLocally(insuranceData, id = null, verified = false) {
            try {
                // Get existing verifications or initialize empty array
                let verifications = JSON.parse(localStorage.getItem('telehealth_insurance') || '[]');
                
                // Add verification with timestamp and ID
                verifications.push({
                    ...insuranceData,
                    id: id || 'local-' + Date.now(),
                    verified: verified,
                    timestamp: new Date().toISOString()
                });
                
                // Save back to local storage
                localStorage.setItem('telehealth_insurance', JSON.stringify(verifications));
                console.log('Insurance verification saved locally');
            } catch (error) {
                console.error('Error saving insurance verification locally:', error);
            }
        }

        // Save appointment data to local storage
        function saveAppointmentLocally(appointmentData, id = null) {
            try {
                // Get existing appointments or initialize empty array
                let appointments = JSON.parse(localStorage.getItem('telehealth_appointments') || '[]');
                
                // Add appointment with timestamp and ID
                appointments.push({
                    ...appointmentData,
                    id: id || 'local-' + Date.now(),
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                });
                
                // Save back to local storage
                localStorage.setItem('telehealth_appointments', JSON.stringify(appointments));
                console.log('Appointment saved locally');
            } catch (error) {
                console.error('Error saving appointment locally:', error);
            }
        }

        // Add this to your existing JavaScript code

        // Handle consultation form submission
        document.getElementById('consultation-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const formData = {
            fullName: document.getElementById('name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            problem: document.getElementById('problem').value,
            location: document.getElementById('location-info').textContent
          };

          try {
            const response = await fetch('/api/telehealth/consultation', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(formData)
            });

            const data = await response.json();
            if (data.success) {
              showAlert(data.message, 'success');
            } else {
              showAlert(data.message, 'danger');
            }
          } catch (error) {
            console.error('Error:', error);
            showAlert('Error submitting consultation request', 'danger');
          }
        });

        // Handle SOS button click
        document.getElementById('sos-btn').addEventListener('click', async () => {
          const fullName = document.getElementById('name').value || 'Anonymous';
          const location = document.getElementById('location-info').textContent;
          
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(async (position) => {
              const coordinates = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };

              try {
                const response = await fetch('/api/telehealth/sos', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    fullName,
                    location,
                    coordinates,
                    emergency_type: 'medical'
                  })
                });

                const data = await response.json();
                if (data.success) {
                  showAlert(`Emergency services notified. ETA: ${data.estimatedResponse}. ${data.instructions}`, 'info');
                } else {
                  showAlert(data.message, 'danger');
                }
              } catch (error) {
                console.error('Error:', error);
                showAlert('Error sending SOS alert', 'danger');
              }
            }, (error) => {
              console.error('Geolocation error:', error);
              showAlert('Error getting location. Please try again.', 'danger');
            });
          } else {
            showAlert('Geolocation is not supported by your browser', 'danger');
          }
        });
    </script>
    
    <!-- Google Maps API Script -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9E2aFacB3bdzlXLedlnVOk6tG_XIsVBA&callback=initMap" async defer></script>
</body>
</html>