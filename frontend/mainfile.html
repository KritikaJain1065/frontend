<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Healthcare Facilities</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, #2193b0, #6dd5ed);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        header h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        /* Navigation */
        nav {
            background-color: #fff;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .nav-links {
            display: flex;
            justify-content: center;
            list-style: none;
            flex-wrap: wrap;
        }
        
        .nav-links li {
            margin: 0 15px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: #2193b0;
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background-color: #2193b0;
            color: white;
        }
        
        /* Content Sections */
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .section h2 {
            color: #2193b0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        th {
            background-color: #f5f7fa;
            font-weight: bold;
            color: #2193b0;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: #2193b0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        
        button:hover {
            background-color: #1a7a8c;
        }
        
        /* Cards */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        
        .card h3 {
            color: #2193b0;
            margin-bottom: 10px;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Modern Healthcare Facilities</h1>
        </div>
    </header>
    
    <nav>
        <div class="container">
            <ul class="nav-links">
                <li><a href="#" class="active" data-section="patient-profiles">Patient Profiles</a></li>
                <li><a href="#" data-section="electronic-health-records">Electronic Health Records</a></li>
                <li><a href="#" data-section="medical-records">Medical Records</a></li>
                <li><a href="#" data-section="prescriptions">Prescriptions</a></li>
                <li><a href="#" data-section="treatment-plans">Treatment Plans</a></li>
                <li><a href="#" data-section="lab-reports">Lab Reports</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <!-- Patient Profiles Section -->
        <section id="patient-profiles" class="section active">
            <h2>Patient Profiles</h2>
            <div class="card-container" id="patientCards">
                <!-- Patient cards will be added here -->
            </div>
            
            <h3 style="margin-top: 30px;">Add New Patient</h3>
            <form id="addPatientForm">
                <div class="form-group">
                    <label for="patientName">Full Name</label>
                    <input type="text" id="patientName" required>
                </div>
                <div class="form-group">
                    <label for="patientAge">Age</label>
                    <input type="number" id="patientAge" required>
                </div>
                <div class="form-group">
                    <label for="patientGender">Gender</label>
                    <select id="patientGender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <button type="submit">Add Patient</button>
            </form>
        </section>
        
        <!-- Electronic Health Records Section -->
        <section id="electronic-health-records" class="section">
            <h2>Electronic Health Records</h2>
            <div class="form-group">
                <label for="selectPatientEHR">Select Patient</label>
                <select id="selectPatientEHR">
                    <option value="">Select a patient</option>
                    <!-- Patient options will be added here -->
                </select>
            </div>
            
            <div id="ehrDetails">
                <!-- EHR details will be displayed here -->
            </div>
            
            <h3 style="margin-top: 30px;">Add Health Record</h3>
            <form id="addEHRForm">
                <div class="form-group">
                    <label for="patientIdEHR">Patient</label>
                    <select id="patientIdEHR" required>
                        <option value="">Select Patient</option>
                        <!-- Patient options will be added here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="healthRecord">Health Record</label>
                    <textarea id="healthRecord" rows="4" required></textarea>
                </div>
                <button type="submit">Add Record</button>
            </form>
        </section>
        
        <!-- Medical Records Section -->
        <section id="medical-records" class="section">
            <h2>Medical Records</h2>
            <div class="form-group">
                <label for="selectPatientMR">Select Patient</label>
                <select id="selectPatientMR">
                    <option value="">Select a patient</option>
                    <!-- Patient options will be added here -->
                </select>
            </div>
            
            <div id="medicalRecordsContainer">
                <!-- Medical records will be displayed here -->
            </div>
            
            <table id="medicalRecordsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Record</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Medical records will be added here -->
                </tbody>
            </table>
        </section>
        
        <!-- Prescriptions Section -->
        <section id="prescriptions" class="section">
            <h2>Prescriptions</h2>
            <div class="form-group">
                <label for="selectPatientRx">Select Patient</label>
                <select id="selectPatientRx">
                    <option value="">Select a patient</option>
                    <!-- Patient options will be added here -->
                </select>
            </div>
            
            <div class="card-container" id="prescriptionCards">
                <!-- Prescription cards will be added here -->
            </div>
            
            <h3 style="margin-top: 30px;">Add Prescription</h3>
            <form id="addPrescriptionForm">
                <div class="form-group">
                    <label for="patientIdRx">Patient</label>
                    <select id="patientIdRx" required>
                        <option value="">Select Patient</option>
                        <!-- Patient options will be added here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="prescriptionText">Prescription</label>
                    <textarea id="prescriptionText" rows="4" required></textarea>
                </div>
                <button type="submit">Add Prescription</button>
            </form>
        </section>
        
        <!-- Treatment Plans Section -->
        <section id="treatment-plans" class="section">
            <h2>Treatment Plans</h2>
            <div class="form-group">
                <label for="selectPatientTP">Select Patient</label>
                <select id="selectPatientTP">
                    <option value="">Select a patient</option>
                    <!-- Patient options will be added here -->
                </select>
            </div>
            
            <div id="treatmentPlanDetails">
                <!-- Treatment plan details will be displayed here -->
            </div>
            
            <h3 style="margin-top: 30px;">Create Treatment Plan</h3>
            <form id="addTreatmentPlanForm">
                <div class="form-group">
                    <label for="patientIdTP">Patient</label>
                    <select id="patientIdTP" required>
                        <option value="">Select Patient</option>
                        <!-- Patient options will be added here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="treatmentPlanTitle">Plan Title</label>
                    <input type="text" id="treatmentPlanTitle" required>
                </div>
                <div class="form-group">
                    <label for="treatmentPlanDescription">Plan Description</label>
                    <textarea id="treatmentPlanDescription" rows="4" required></textarea>
                </div>
                <button type="submit">Create Plan</button>
            </form>
        </section>
        
        <!-- Lab Reports Section -->
        <section id="lab-reports" class="section">
            <h2>Lab Reports</h2>
            <div class="form-group">
                <label for="selectPatientLR">Select Patient</label>
                <select id="selectPatientLR">
                    <option value="">Select a patient</option>
                    <!-- Patient options will be added here -->
                </select>
            </div>
            
            <table id="labReportsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Report</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Lab reports will be added here -->
                </tbody>
            </table>
            
            <h3 style="margin-top: 30px;">Add Lab Report</h3>
            <form id="addLabReportForm">
                <div class="form-group">
                    <label for="patientIdLR">Patient</label>
                    <select id="patientIdLR" required>
                        <option value="">Select Patient</option>
                        <!-- Patient options will be added here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="labReportText">Report Details</label>
                    <textarea id="labReportText" rows="4" required></textarea>
                </div>
                <button type="submit">Add Report</button>
            </form>
        </section>
    </div>
    
    <footer class="container">
        <p>&copy; 2023 Modern Healthcare Facilities. All rights reserved.</p>
    </footer>
    
    <script>
        // Navigation
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links and sections
                document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
                document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show the corresponding section
                const sectionId = this.dataset.section;
                document.getElementById(sectionId).classList.add('active');
            });
        });
        
        // Fetch all patients
        async function fetchPatients() {
            try {
                const response = await fetch('/api/patients');
                const data = await response.json();
                return data.patients;
            } catch (error) {
                console.error('Error fetching patients:', error);
                return [];
            }
        }
        
        // Populate patient dropdowns
        async function populatePatientDropdowns() {
            const patients = await fetchPatients();
            const dropdowns = [
                'selectPatientEHR', 
                'patientIdEHR', 
                'selectPatientMR', 
                'selectPatientRx', 
                'patientIdRx', 
                'selectPatientTP', 
                'patientIdTP', 
                'selectPatientLR', 
                'patientIdLR'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    // Clear existing options except the first one
                    while (dropdown.options.length > 1) {
                        dropdown.remove(1);
                    }
                    
                    // Add patient options
                    patients.forEach(patient => {
                        const option = document.createElement('option');
                        option.value = patient.id;
                        option.textContent = patient.name;
                        dropdown.appendChild(option);
                    });
                }
            });
        }
        
        // Display patient cards
        async function displayPatientCards() {
            const patients = await fetchPatients();
            const container = document.getElementById('patientCards');
            container.innerHTML = '';
            
            if (patients.length === 0) {
                container.innerHTML = '<p>No patients found.</p>';
                return;
            }
            
            patients.forEach(patient => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${patient.name}</h3>
                    <p><strong>Age:</strong> ${patient.age}</p>
                    <p><strong>Gender:</strong> ${patient.gender}</p>
                    <button class="view-btn" data-id="${patient.id}">View Details</button>
                `;
                container.appendChild(card);
            });

            // Add event listeners to view buttons
            document.querySelectorAll('.view-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const patientId = this.dataset.id;
                    document.querySelectorAll('.nav-links a')[1].click(); // Switch to EHR section
                    document.getElementById('selectPatientEHR').value = patientId;
                    displayHealthRecords(patientId);
                });
            });
        }
        
        // Fetch health records
        async function fetchHealthRecords(patientId) {
            try {
                const response = await fetch(`/api/health-records/${patientId}`);
                const data = await response.json();
                return data.healthRecords;
            } catch (error) {
                console.error('Error fetching health records:', error);
                return [];
            }
        }
        
        // Display health records
        async function displayHealthRecords(patientId) {
            const records = await fetchHealthRecords(patientId);
            const container = document.getElementById('ehrDetails');
            container.innerHTML = '';
            
            if (records.length === 0) {
                container.innerHTML = '<p>No health records found for this patient.</p>';
                return;
            }
            
            const div = document.createElement('div');
            div.className = 'card';
            let recordsHTML = '';
            
            records.forEach(record => {
                recordsHTML += `<p><strong>Record ${record.id}:</strong> ${record.record}</p>`;
            });
            
            div.innerHTML = recordsHTML;
            container.appendChild(div);
        }
        
        // Fetch prescriptions
        async function fetchPrescriptions(patientId) {
            try {
                const response = await fetch(`/api/prescriptions/${patientId}`);
                const data = await response.json();
                return data.prescriptions;
            } catch (error) {
                console.error('Error fetching prescriptions:', error);
                return [];
            }
        }
        
        // Display prescriptions
        async function displayPrescriptions(patientId) {
            const prescriptions = await fetchPrescriptions(patientId);
            const container = document.getElementById('prescriptionCards');
            container.innerHTML = '';
            
            if (prescriptions.length === 0) {
                container.innerHTML = '<p>No prescriptions found for this patient.</p>';
                return;
            }
            
            prescriptions.forEach(prescription => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>Prescription #${prescription.id}</h3>
                    <p>${prescription.prescription}</p>
                `;
                container.appendChild(card);
            });
        }
        
        // Fetch lab reports
        async function fetchLabReports(patientId) {
            try {
                const response = await fetch(`/api/lab-reports/${patientId}`);
                const data = await response.json();
                return data.labReports;
            } catch (error) {
                console.error('Error fetching lab reports:', error);
                return [];
            }
        }
        
        // Display lab reports
        async function displayLabReports(patientId) {
            const reports = await fetchLabReports(patientId);
            const tbody = document.querySelector('#labReportsTable tbody');
            tbody.innerHTML = '';
            
            if (reports.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3">No lab reports found for this patient.</td></tr>';
                return;
            }
            
            reports.forEach(report => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${report.id}</td>
                    <td>${report.report}</td>
                    <td><button class="view-report-btn" data-id="${report.id}">View</button></td>
                `;
                tbody.appendChild(row);
            });

            // Add event listeners to view buttons
            document.querySelectorAll('.view-report-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const reportId = this.dataset.id;
                    const report = reports.find(r => r.id == reportId);
                    if (report) {
                        alert(`Lab Report #${report.id}: ${report.report}`);
                    }
                });
            });
        }

        // Fetch treatment plans
        async function fetchTreatmentPlans(patientId) {
            try {
                const response = await fetch(`/api/treatment-plans/${patientId}`);
                const data = await response.json();
                return data.treatmentPlans;
            } catch (error) {
                console.error('Error fetching treatment plans:', error);
                return [];
            }
        }
        
        // Display treatment plans
        async function displayTreatmentPlans(patientId) {
            const plans = await fetchTreatmentPlans(patientId);
            const container = document.getElementById('treatmentPlanDetails');
            container.innerHTML = '';
            
            if (plans.length === 0) {
                container.innerHTML = '<p>No treatment plans found for this patient.</p>';
                return;
            }
            
            plans.forEach(plan => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <h3>${plan.title}</h3>
                    <p>${plan.description}</p>
                `;
                container.appendChild(div);
            });
        }
        
        // Event listeners for patient selection
        document.getElementById('selectPatientEHR').addEventListener('change', function() {
            if (this.value) {
                displayHealthRecords(this.value);
            } else {
                document.getElementById('ehrDetails').innerHTML = '';
            }
        });
        
        document.getElementById('selectPatientMR').addEventListener('change', function() {
            if (this.value) {
                displayHealthRecords(this.value);
            } else {
                document.getElementById('medicalRecordsContainer').innerHTML = '';
            }
        });
        
        document.getElementById('selectPatientRx').addEventListener('change', function() {
            if (this.value) {
                displayPrescriptions(this.value);
            } else {
                document.getElementById('prescriptionCards').innerHTML = '';
            }
        });
        
        document.getElementById('selectPatientTP').addEventListener('change', function() {
            if (this.value) {
                displayTreatmentPlans(this.value);
            } else {
                document.getElementById('treatmentPlanDetails').innerHTML = '';
            }
        });
        
        document.getElementById('selectPatientLR').addEventListener('change', function() {
            if (this.value) {
                displayLabReports(this.value);
            } else {
                document.querySelector('#labReportsTable tbody').innerHTML = '';
            }
        });
        
        // Form submission handlers
        document.getElementById('addPatientForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('patientName').value;
            const age = document.getElementById('patientAge').value;
            const gender = document.getElementById('patientGender').value;
            
            try {
                const response = await fetch('/api/patients', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, age, gender })
                });
                
                if (response.ok) {
                    alert('Patient added successfully!');
                    this.reset();
                    displayPatientCards();
                    populatePatientDropdowns();
                } else {
                    alert('Failed to add patient.');
                }
            } catch (error) {
                console.error('Error adding patient:', error);
                alert('An error occurred while adding the patient.');
            }
        });
        
        document.getElementById('addEHRForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const patient_id = document.getElementById('patientIdEHR').value;
            const record = document.getElementById('healthRecord').value;
            
            try {
                const response = await fetch('/api/health-records', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ patient_id, record })
                });
                
                if (response.ok) {
                    alert('Health record added successfully!');
                    this.reset();
                    if (document.getElementById('selectPatientEHR').value === patient_id) {
                        displayHealthRecords(patient_id);
                    }
                } else {
                    alert('Failed to add health record.');
                }
            } catch (error) {
                console.error('Error adding health record:', error);
                alert('An error occurred while adding the health record.');
            }
        });
        
        document.getElementById('addPrescriptionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const patient_id = document.getElementById('patientIdRx').value;
            const prescription = document.getElementById('prescriptionText').value;
            
            try {
                const response = await fetch('/api/prescriptions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ patient_id, prescription })
                });
                
                if (response.ok) {
                    alert('Prescription added successfully!');
                    this.reset();
                    if (document.getElementById('selectPatientRx').value === patient_id) {
                        displayPrescriptions(patient_id);
                    }
                } else {
                    alert('Failed to add prescription.');
                }
            } catch (error) {
                console.error('Error adding prescription:', error);
                alert('An error occurred while adding the prescription.');
            }
        });
        
        document.getElementById('addTreatmentPlanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const patient_id = document.getElementById('patientIdTP').value;
            const title = document.getElementById('treatmentPlanTitle').value;
            const description = document.getElementById('treatmentPlanDescription').value;
            
            try {
                const response = await fetch('/api/treatment-plans', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ patient_id, title, description })
                });
                
                if (response.ok) {
                    alert('Treatment plan created successfully!');
                    this.reset();
                    if (document.getElementById('selectPatientTP').value === patient_id) {
                        displayTreatmentPlans(patient_id);
                    }
                } else {
                    alert('Failed to create treatment plan.');
                }
            } catch (error) {
                console.error('Error creating treatment plan:', error);
                alert('An error occurred while creating the treatment plan.');
            }
        });
        
        document.getElementById('addLabReportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const patient_id = document.getElementById('patientIdLR').value;
            const report = document.getElementById('labReportText').value;
            
            try {
                const response = await fetch('/api/lab-reports', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ patient_id, report })
                });
                
                if (response.ok) {
                    alert('Lab report added successfully!');
                    this.reset();
                    if (document.getElementById('selectPatientLR').value === patient_id) {
                        displayLabReports(patient_id);
                    }
                } else {
                    alert('Failed to add lab report.');
                }
            } catch (error) {
                console.error('Error adding lab report:', error);
                alert('An error occurred while adding the lab report.');
            }
        });
        
        // Initialize the page
        window.addEventListener('DOMContentLoaded', function() {
            displayPatientCards();
            populatePatientDropdowns();
        });
    </script>
</body>
</html>
